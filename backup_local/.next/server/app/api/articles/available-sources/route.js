/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/articles/available-sources/route";
exports.ids = ["app/api/articles/available-sources/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Farticles%2Favailable-sources%2Froute&page=%2Fapi%2Farticles%2Favailable-sources%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Farticles%2Favailable-sources%2Froute.ts&appDir=%2FUsers%2Fmarkau%2Fpanora8A%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmarkau%2Fpanora8A&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Farticles%2Favailable-sources%2Froute&page=%2Fapi%2Farticles%2Favailable-sources%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Farticles%2Favailable-sources%2Froute.ts&appDir=%2FUsers%2Fmarkau%2Fpanora8A%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmarkau%2Fpanora8A&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_markau_panora8A_app_api_articles_available_sources_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/articles/available-sources/route.ts */ \"(rsc)/./app/api/articles/available-sources/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/articles/available-sources/route\",\n        pathname: \"/api/articles/available-sources\",\n        filename: \"route\",\n        bundlePath: \"app/api/articles/available-sources/route\"\n    },\n    resolvedPagePath: \"/Users/markau/panora8A/app/api/articles/available-sources/route.ts\",\n    nextConfigOutput,\n    userland: _Users_markau_panora8A_app_api_articles_available_sources_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/articles/available-sources/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhcnRpY2xlcyUyRmF2YWlsYWJsZS1zb3VyY2VzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhcnRpY2xlcyUyRmF2YWlsYWJsZS1zb3VyY2VzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYXJ0aWNsZXMlMkZhdmFpbGFibGUtc291cmNlcyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm1hcmthdSUyRnBhbm9yYThBJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRm1hcmthdSUyRnBhbm9yYThBJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNrQjtBQUMvRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2hraS16b25lLz83MTk4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9tYXJrYXUvcGFub3JhOEEvYXBwL2FwaS9hcnRpY2xlcy9hdmFpbGFibGUtc291cmNlcy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYXJ0aWNsZXMvYXZhaWxhYmxlLXNvdXJjZXMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hcnRpY2xlcy9hdmFpbGFibGUtc291cmNlc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYXJ0aWNsZXMvYXZhaWxhYmxlLXNvdXJjZXMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvbWFya2F1L3Bhbm9yYThBL2FwcC9hcGkvYXJ0aWNsZXMvYXZhaWxhYmxlLXNvdXJjZXMvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2FydGljbGVzL2F2YWlsYWJsZS1zb3VyY2VzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Farticles%2Favailable-sources%2Froute&page=%2Fapi%2Farticles%2Favailable-sources%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Farticles%2Favailable-sources%2Froute.ts&appDir=%2FUsers%2Fmarkau%2Fpanora8A%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmarkau%2Fpanora8A&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/articles/available-sources/route.ts":
/*!*****************************************************!*\
  !*** ./app/api/articles/available-sources/route.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./lib/supabase.ts\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabase-server */ \"(rsc)/./lib/supabase-server.ts\");\n\n\n\nconst dynamic = \"force-dynamic\";\n// Hardcoded fallback sources when database is not available\nconst FALLBACK_SOURCES = [\n    \"Bloomberg\",\n    \"SCMP\",\n    \"HKFP\",\n    \"RTHK\",\n    \"HK01\",\n    \"TVB\",\n    \"The Standard\",\n    \"Now News\",\n    \"Hong Kong Government News\"\n];\nasync function GET() {\n    try {\n        console.log(\"Available sources API called, checking database setup...\");\n        // Check if database is set up\n        const isDatabaseReady = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.checkDatabaseSetup)();\n        if (!isDatabaseReady) {\n            console.warn(\"Database not set up, using fallback sources\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                sources: FALLBACK_SOURCES,\n                usingFallbackData: true\n            });\n        }\n        // Query database for distinct sources with articles\n        // Use raw SQL to get distinct sources to avoid row limits\n        const { data, error } = await _lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"articles\").select(\"source\").is(\"deleted_at\", null) // Only include non-deleted articles\n        .not(\"source\", \"is\", null) // Exclude articles without source\n        .order(\"created_at\", {\n            ascending: false\n        }) // Order by newest first\n        .limit(5000) // Set a reasonable limit to get recent sources\n        ;\n        if (error) {\n            console.error(\"Error fetching sources from database:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                sources: FALLBACK_SOURCES,\n                usingFallbackData: true\n            });\n        }\n        // Get unique sources from database\n        const uniqueSources = new Set();\n        data?.forEach((row)=>{\n            if (row.source) {\n                // Clean up source name\n                const cleanSource = row.source.replace(\" (AI Enhanced)\", \"\").replace(/ \\+ AI$/, \"\").trim();\n                uniqueSources.add(cleanSource);\n            }\n        });\n        const availableSources = Array.from(uniqueSources).sort();\n        console.log(`Found ${availableSources.length} unique sources in database:`, availableSources);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            sources: availableSources,\n            usingFallbackData: false\n        });\n    } catch (error) {\n        console.error(\"Error in available sources API:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            sources: FALLBACK_SOURCES,\n            usingFallbackData: true\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2FydGljbGVzL2F2YWlsYWJsZS1zb3VyY2VzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQTBDO0FBQ1M7QUFDRTtBQUU5QyxNQUFNRyxVQUFVLGdCQUFlO0FBRXRDLDREQUE0RDtBQUM1RCxNQUFNQyxtQkFBbUI7SUFDdkI7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0NBQ0Q7QUFFTSxlQUFlQztJQUNwQixJQUFJO1FBQ0ZDLFFBQVFDLEdBQUcsQ0FBQztRQUVaLDhCQUE4QjtRQUM5QixNQUFNQyxrQkFBa0IsTUFBTVAsaUVBQWtCQTtRQUVoRCxJQUFJLENBQUNPLGlCQUFpQjtZQUNwQkYsUUFBUUcsSUFBSSxDQUFDO1lBQ2IsT0FBT1QscURBQVlBLENBQUNVLElBQUksQ0FBQztnQkFDdkJDLFNBQVNQO2dCQUNUUSxtQkFBbUI7WUFDckI7UUFDRjtRQUVBLG9EQUFvRDtRQUNwRCwwREFBMEQ7UUFDMUQsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1aLCtEQUFhQSxDQUN4Q2EsSUFBSSxDQUFDLFlBQ0xDLE1BQU0sQ0FBQyxVQUNQQyxFQUFFLENBQUMsY0FBYyxNQUFNLG9DQUFvQztTQUMzREMsR0FBRyxDQUFDLFVBQVUsTUFBTSxNQUFNLGtDQUFrQztTQUM1REMsS0FBSyxDQUFDLGNBQWM7WUFBRUMsV0FBVztRQUFNLEdBQUcsd0JBQXdCO1NBQ2xFQyxLQUFLLENBQUMsTUFBTSwrQ0FBK0M7O1FBRTlELElBQUlQLE9BQU87WUFDVFIsUUFBUVEsS0FBSyxDQUFDLHlDQUF5Q0E7WUFDdkQsT0FBT2QscURBQVlBLENBQUNVLElBQUksQ0FBQztnQkFDdkJDLFNBQVNQO2dCQUNUUSxtQkFBbUI7WUFDckI7UUFDRjtRQUVBLG1DQUFtQztRQUNuQyxNQUFNVSxnQkFBZ0IsSUFBSUM7UUFFMUJWLE1BQU1XLFFBQVFDLENBQUFBO1lBQ1osSUFBSUEsSUFBSUMsTUFBTSxFQUFFO2dCQUNkLHVCQUF1QjtnQkFDdkIsTUFBTUMsY0FBY0YsSUFBSUMsTUFBTSxDQUFDRSxPQUFPLENBQUMsa0JBQWtCLElBQUlBLE9BQU8sQ0FBQyxXQUFXLElBQUlDLElBQUk7Z0JBQ3hGUCxjQUFjUSxHQUFHLENBQUNIO1lBQ3BCO1FBQ0Y7UUFFQSxNQUFNSSxtQkFBbUJDLE1BQU1qQixJQUFJLENBQUNPLGVBQWVXLElBQUk7UUFFdkQzQixRQUFRQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUV3QixpQkFBaUJHLE1BQU0sQ0FBQyw0QkFBNEIsQ0FBQyxFQUFFSDtRQUU1RSxPQUFPL0IscURBQVlBLENBQUNVLElBQUksQ0FBQztZQUN2QkMsU0FBU29CO1lBQ1RuQixtQkFBbUI7UUFDckI7SUFFRixFQUFFLE9BQU9FLE9BQU87UUFDZFIsUUFBUVEsS0FBSyxDQUFDLG1DQUFtQ0E7UUFFakQsT0FBT2QscURBQVlBLENBQUNVLElBQUksQ0FBQztZQUN2QkMsU0FBU1A7WUFDVFEsbUJBQW1CO1FBQ3JCO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2hraS16b25lLy4vYXBwL2FwaS9hcnRpY2xlcy9hdmFpbGFibGUtc291cmNlcy9yb3V0ZS50cz9hNDA1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiXG5pbXBvcnQgeyBjaGVja0RhdGFiYXNlU2V0dXAgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2VcIlxuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS1zZXJ2ZXJcIlxuXG5leHBvcnQgY29uc3QgZHluYW1pYyA9ICdmb3JjZS1keW5hbWljJ1xuXG4vLyBIYXJkY29kZWQgZmFsbGJhY2sgc291cmNlcyB3aGVuIGRhdGFiYXNlIGlzIG5vdCBhdmFpbGFibGVcbmNvbnN0IEZBTExCQUNLX1NPVVJDRVMgPSBbXG4gIFwiQmxvb21iZXJnXCIsXG4gIFwiU0NNUFwiLCBcbiAgXCJIS0ZQXCIsXG4gIFwiUlRIS1wiLFxuICBcIkhLMDFcIixcbiAgXCJUVkJcIixcbiAgXCJUaGUgU3RhbmRhcmRcIixcbiAgXCJOb3cgTmV3c1wiLFxuICBcIkhvbmcgS29uZyBHb3Zlcm5tZW50IE5ld3NcIlxuXVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKCkge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKFwiQXZhaWxhYmxlIHNvdXJjZXMgQVBJIGNhbGxlZCwgY2hlY2tpbmcgZGF0YWJhc2Ugc2V0dXAuLi5cIilcbiAgICBcbiAgICAvLyBDaGVjayBpZiBkYXRhYmFzZSBpcyBzZXQgdXBcbiAgICBjb25zdCBpc0RhdGFiYXNlUmVhZHkgPSBhd2FpdCBjaGVja0RhdGFiYXNlU2V0dXAoKVxuICAgIFxuICAgIGlmICghaXNEYXRhYmFzZVJlYWR5KSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJEYXRhYmFzZSBub3Qgc2V0IHVwLCB1c2luZyBmYWxsYmFjayBzb3VyY2VzXCIpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzb3VyY2VzOiBGQUxMQkFDS19TT1VSQ0VTLFxuICAgICAgICB1c2luZ0ZhbGxiYWNrRGF0YTogdHJ1ZVxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBRdWVyeSBkYXRhYmFzZSBmb3IgZGlzdGluY3Qgc291cmNlcyB3aXRoIGFydGljbGVzXG4gICAgLy8gVXNlIHJhdyBTUUwgdG8gZ2V0IGRpc3RpbmN0IHNvdXJjZXMgdG8gYXZvaWQgcm93IGxpbWl0c1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCdhcnRpY2xlcycpXG4gICAgICAuc2VsZWN0KCdzb3VyY2UnKVxuICAgICAgLmlzKCdkZWxldGVkX2F0JywgbnVsbCkgLy8gT25seSBpbmNsdWRlIG5vbi1kZWxldGVkIGFydGljbGVzXG4gICAgICAubm90KCdzb3VyY2UnLCAnaXMnLCBudWxsKSAvLyBFeGNsdWRlIGFydGljbGVzIHdpdGhvdXQgc291cmNlXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSkgLy8gT3JkZXIgYnkgbmV3ZXN0IGZpcnN0XG4gICAgICAubGltaXQoNTAwMCkgLy8gU2V0IGEgcmVhc29uYWJsZSBsaW1pdCB0byBnZXQgcmVjZW50IHNvdXJjZXNcbiAgICBcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBzb3VyY2VzIGZyb20gZGF0YWJhc2U6XCIsIGVycm9yKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc291cmNlczogRkFMTEJBQ0tfU09VUkNFUyxcbiAgICAgICAgdXNpbmdGYWxsYmFja0RhdGE6IHRydWVcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgLy8gR2V0IHVuaXF1ZSBzb3VyY2VzIGZyb20gZGF0YWJhc2VcbiAgICBjb25zdCB1bmlxdWVTb3VyY2VzID0gbmV3IFNldDxzdHJpbmc+KClcbiAgICBcbiAgICBkYXRhPy5mb3JFYWNoKHJvdyA9PiB7XG4gICAgICBpZiAocm93LnNvdXJjZSkge1xuICAgICAgICAvLyBDbGVhbiB1cCBzb3VyY2UgbmFtZVxuICAgICAgICBjb25zdCBjbGVhblNvdXJjZSA9IHJvdy5zb3VyY2UucmVwbGFjZSgnIChBSSBFbmhhbmNlZCknLCAnJykucmVwbGFjZSgvIFxcKyBBSSQvLCAnJykudHJpbSgpXG4gICAgICAgIHVuaXF1ZVNvdXJjZXMuYWRkKGNsZWFuU291cmNlKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBhdmFpbGFibGVTb3VyY2VzID0gQXJyYXkuZnJvbSh1bmlxdWVTb3VyY2VzKS5zb3J0KClcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgRm91bmQgJHthdmFpbGFibGVTb3VyY2VzLmxlbmd0aH0gdW5pcXVlIHNvdXJjZXMgaW4gZGF0YWJhc2U6YCwgYXZhaWxhYmxlU291cmNlcylcbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc291cmNlczogYXZhaWxhYmxlU291cmNlcyxcbiAgICAgIHVzaW5nRmFsbGJhY2tEYXRhOiBmYWxzZVxuICAgIH0pXG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGluIGF2YWlsYWJsZSBzb3VyY2VzIEFQSTpcIiwgZXJyb3IpXG4gICAgXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHNvdXJjZXM6IEZBTExCQUNLX1NPVVJDRVMsXG4gICAgICB1c2luZ0ZhbGxiYWNrRGF0YTogdHJ1ZVxuICAgIH0pXG4gIH1cbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY2hlY2tEYXRhYmFzZVNldHVwIiwic3VwYWJhc2VBZG1pbiIsImR5bmFtaWMiLCJGQUxMQkFDS19TT1VSQ0VTIiwiR0VUIiwiY29uc29sZSIsImxvZyIsImlzRGF0YWJhc2VSZWFkeSIsIndhcm4iLCJqc29uIiwic291cmNlcyIsInVzaW5nRmFsbGJhY2tEYXRhIiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImlzIiwibm90Iiwib3JkZXIiLCJhc2NlbmRpbmciLCJsaW1pdCIsInVuaXF1ZVNvdXJjZXMiLCJTZXQiLCJmb3JFYWNoIiwicm93Iiwic291cmNlIiwiY2xlYW5Tb3VyY2UiLCJyZXBsYWNlIiwidHJpbSIsImFkZCIsImF2YWlsYWJsZVNvdXJjZXMiLCJBcnJheSIsInNvcnQiLCJsZW5ndGgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/articles/available-sources/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase-server.ts":
/*!********************************!*\
  !*** ./lib/supabase-server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkDatabaseSetup: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.checkDatabaseSetup),\n/* harmony export */   checkHeadlinesTableSetup: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.checkHeadlinesTableSetup),\n/* harmony export */   checkPerplexityNewsTableSetup: () => (/* binding */ checkPerplexityNewsTableSetup),\n/* harmony export */   cleanupOldHeadlines: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.cleanupOldHeadlines),\n/* harmony export */   getArticleById: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.getArticleById),\n/* harmony export */   getArticleStats: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.getArticleStats),\n/* harmony export */   getArticles: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.getArticles),\n/* harmony export */   getArticlesRegular: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.getArticlesRegular),\n/* harmony export */   getBalancedArticles: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.getBalancedArticles),\n/* harmony export */   getEnhancementStats: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.getEnhancementStats),\n/* harmony export */   getHeadlines: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.getHeadlines),\n/* harmony export */   getHeadlinesByCategory: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.getHeadlinesByCategory),\n/* harmony export */   getPendingPerplexityNews: () => (/* binding */ getPendingPerplexityNews),\n/* harmony export */   getPerplexityNews: () => (/* binding */ getPerplexityNews),\n/* harmony export */   getPerplexityNewsByCategory: () => (/* binding */ getPerplexityNewsByCategory),\n/* harmony export */   getPerplexityNewsByCategoryAdmin: () => (/* binding */ getPerplexityNewsByCategoryAdmin),\n/* harmony export */   getRecentPerplexityTitles: () => (/* binding */ getRecentPerplexityTitles),\n/* harmony export */   getRecentlyUsedImages: () => (/* binding */ getRecentlyUsedImages),\n/* harmony export */   isImageRecentlyUsed: () => (/* binding */ isImageRecentlyUsed),\n/* harmony export */   saveArticle: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.saveArticle),\n/* harmony export */   saveHeadlines: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.saveHeadlines),\n/* harmony export */   savePerplexityHeadlines: () => (/* binding */ savePerplexityHeadlines),\n/* harmony export */   searchArticles: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.searchArticles),\n/* harmony export */   supabase: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin),\n/* harmony export */   trackImageUsage: () => (/* binding */ trackImageUsage),\n/* harmony export */   updatePerplexityArticle: () => (/* binding */ updatePerplexityArticle)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./lib/supabase.ts\");\n\nconst supabaseUrl = \"https://egyuetfeubznhcvmtary.supabase.co\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!supabaseUrl) {\n    throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n}\nif (!supabaseServiceKey) {\n    throw new Error(\"Missing SUPABASE_SERVICE_ROLE_KEY environment variable\");\n}\n// Server-only client with service role key for admin operations\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n// Re-export types and interfaces for convenience \n\n// Server-side Perplexity functions that need admin privileges\nasync function savePerplexityHeadlines(headlines) {\n    try {\n        console.log(`ðŸ’¾ Attempting to save ${headlines.length} Perplexity headlines to database...`);\n        // Log each headline being saved\n        headlines.forEach((headline, i)=>{\n            console.log(`  ${i + 1}. [${headline.category}] ${headline.title}`);\n            console.log(`     URL: ${headline.url}`);\n            console.log(`     Status: ${headline.article_status}`);\n        });\n        // Insert headlines one by one to get accurate count of successful inserts\n        const savedHeadlines = [];\n        const duplicateCount = [];\n        for (const headline of headlines){\n            try {\n                // Remove published_at field if present (using only created_at/updated_at pattern)\n                const { published_at, ...headlineData } = headline;\n                const { data, error } = await supabaseAdmin.from(\"perplexity_news\").insert(headlineData).select().single();\n                if (error) {\n                    if (error.code === \"23505\") {\n                        duplicateCount.push(headline.title);\n                    } else {\n                        console.error(`âŒ Error saving headline \"${headline.title}\":`, error.message);\n                    }\n                } else {\n                    savedHeadlines.push(data);\n                }\n            } catch (err) {\n                console.error(`âŒ Unexpected error saving headline \"${headline.title}\":`, err);\n            }\n        }\n        console.log(`âœ… Database operation completed:`);\n        console.log(`  - Headlines generated: ${headlines.length}`);\n        console.log(`  - Successfully saved: ${savedHeadlines.length}`);\n        console.log(`  - Duplicates skipped: ${duplicateCount.length}`);\n        if (savedHeadlines.length > 0) {\n            console.log(\"\\uD83D\\uDCCB Saved headlines IDs:\", savedHeadlines.map((h)=>h.id));\n        }\n        if (duplicateCount.length > 0) {\n            console.log(\"\\uD83D\\uDD04 Duplicate headlines skipped:\", duplicateCount.slice(0, 3).map((title)=>`\"${title}\"`).join(\", \"));\n        }\n        return {\n            data: savedHeadlines,\n            count: savedHeadlines.length\n        };\n    } catch (error) {\n        console.error(\"\\uD83D\\uDCA5 Critical error in savePerplexityHeadlines:\");\n        console.error(\"  - Error type:\", error.constructor.name);\n        console.error(\"  - Error message:\", error.message);\n        console.error(\"  - Error stack:\", error.stack);\n        throw error;\n    }\n}\nasync function getPendingPerplexityNews(limit = 10) {\n    try {\n        console.log(`ðŸ“Š getPendingPerplexityNews: Looking for up to ${limit} articles needing processing...`);\n        const { data, error } = await supabaseAdmin.from(\"perplexity_news\").select(\"*\").or(\"article_status.eq.pending,image_status.eq.failed,image_status.eq.pending\").order(\"created_at\", {\n            ascending: true\n        }).limit(limit);\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Perplexity news table does not exist. Please run the database setup.\");\n                return [];\n            }\n            throw error;\n        }\n        console.log(`ðŸ“Š getPendingPerplexityNews: Found ${data?.length || 0} pending articles`);\n        if (data?.length) {\n            data.forEach((article, i)=>{\n                console.log(`  ${i + 1}. [${article.category}] ${article.title} (${article.article_status})`);\n            });\n        }\n        return data || [];\n    } catch (error) {\n        console.error(\"Error fetching pending Perplexity news:\", error);\n        return [];\n    }\n}\nasync function updatePerplexityArticle(id, updates) {\n    try {\n        const { data, error } = await supabaseAdmin.from(\"perplexity_news\").update(updates).eq(\"id\", id).select().single();\n        if (error) {\n            // Check if the error is about missing enhanced fields\n            if (error.code === \"PGRST204\" && error.message.includes(\"enhanced_title\")) {\n                console.warn(\"âš ï¸  Enhanced fields not available in schema, using legacy fields only\");\n                // Filter out enhanced fields and retry with legacy fields only\n                const legacyUpdates = Object.fromEntries(Object.entries(updates).filter(([key])=>![\n                        \"enhanced_title\",\n                        \"summary\",\n                        \"key_points\",\n                        \"why_it_matters\",\n                        \"structured_sources\"\n                    ].includes(key)));\n                if (Object.keys(legacyUpdates).length > 0) {\n                    console.log(\"\\uD83D\\uDD04 Retrying with legacy fields only:\", Object.keys(legacyUpdates));\n                    const { data: legacyData, error: legacyError } = await supabaseAdmin.from(\"perplexity_news\").update(legacyUpdates).eq(\"id\", id).select().single();\n                    if (legacyError) {\n                        console.error(\"Error updating with legacy fields:\", legacyError);\n                        throw legacyError;\n                    }\n                    return legacyData;\n                }\n            }\n            console.error(\"Error updating Perplexity article:\", error);\n            throw error;\n        }\n        return data;\n    } catch (error) {\n        console.error(\"Error in updatePerplexityArticle:\", error);\n        throw error;\n    }\n}\nasync function getPerplexityNews(category, limit = 20) {\n    try {\n        let query = supabaseAdmin.from(\"perplexity_news\").select(\"*\").in(\"article_status\", [\n            \"ready\",\n            \"pending\",\n            \"enriched\"\n        ]) // Include all statuses for now\n        .order(\"updated_at\", {\n            ascending: false\n        });\n        if (category) {\n            query = query.eq(\"category\", category);\n        }\n        const { data, error } = await query.limit(limit);\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Perplexity news table does not exist. Please run the database setup.\");\n                return [];\n            }\n            throw error;\n        }\n        console.log(`ðŸ“Š getPerplexityNews: Found ${data?.length || 0} articles for category: ${category || \"all\"}`);\n        return data || [];\n    } catch (error) {\n        console.error(\"Error fetching Perplexity news:\", error);\n        return [];\n    }\n}\nasync function getRecentPerplexityTitles(days = 7) {\n    try {\n        const cutoffDate = new Date();\n        cutoffDate.setDate(cutoffDate.getDate() - days);\n        console.log(`ðŸ“Š getRecentPerplexityTitles: Fetching titles from last ${days} days...`);\n        const { data, error } = await supabaseAdmin.from(\"perplexity_news\").select(\"title, category\").gte(\"created_at\", cutoffDate.toISOString()).order(\"created_at\", {\n            ascending: false\n        });\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Perplexity news table does not exist. Please run the database setup.\");\n                return [];\n            }\n            throw error;\n        }\n        console.log(`ðŸ“Š getRecentPerplexityTitles: Found ${data?.length || 0} recent titles`);\n        return data || [];\n    } catch (error) {\n        console.error(\"Error fetching recent Perplexity titles:\", error);\n        return [];\n    }\n}\nasync function getPerplexityNewsByCategory(limitPerCategory = 10) {\n    try {\n        console.log(\"\\uD83D\\uDCCA getPerplexityNewsByCategory: Fetching all articles...\");\n        const { data, error } = await supabaseAdmin.from(\"perplexity_news\").select(\"*\").in(\"article_status\", [\n            \"ready\",\n            \"pending\",\n            \"enriched\"\n        ]) // Include all statuses for now\n        .neq(\"source\", \"Perplexity AI (Fallback)\") // Exclude fallback articles\n        .order(\"updated_at\", {\n            ascending: false\n        });\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Perplexity news table does not exist. Please run the database setup.\");\n                return {};\n            }\n            throw error;\n        }\n        console.log(`ðŸ“Š getPerplexityNewsByCategory: Found ${data?.length || 0} total articles`);\n        // Group by category with configurable limit\n        const groupedNews = (data || []).reduce((acc, article)=>{\n            if (!acc[article.category]) {\n                acc[article.category] = [];\n            }\n            // Apply limit only if limitPerCategory > 0 (0 means no limit)\n            if (limitPerCategory === 0 || acc[article.category].length < limitPerCategory) {\n                acc[article.category].push(article);\n            }\n            return acc;\n        }, {});\n        console.log(`ðŸ“Š getPerplexityNewsByCategory: Grouped into categories:`, Object.keys(groupedNews));\n        Object.keys(groupedNews).forEach((cat)=>{\n            console.log(`  - ${cat}: ${groupedNews[cat].length} articles`);\n        });\n        return groupedNews;\n    } catch (error) {\n        console.error(\"Error fetching Perplexity news by category:\", error);\n        return {};\n    }\n}\nasync function getPerplexityNewsByCategoryAdmin() {\n    // Admin version with no per-category limit\n    return getPerplexityNewsByCategory(0);\n}\nasync function checkPerplexityNewsTableSetup() {\n    try {\n        const { data, error } = await supabaseAdmin.from(\"perplexity_news\").select(\"id\").limit(1);\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                return false;\n            }\n            throw error;\n        }\n        return true;\n    } catch (error) {\n        console.error(\"Perplexity news table setup check failed:\", error);\n        return false;\n    }\n}\n// Image history tracking functions\nasync function trackImageUsage(imageUrl, articleId, category, source, searchQuery) {\n    try {\n        console.log(`ðŸ“¸ Tracking image usage: ${imageUrl} for article ${articleId}`);\n        const { data, error } = await supabaseAdmin.from(\"perplexity_image_history\").insert({\n            image_url: imageUrl,\n            article_id: articleId,\n            category,\n            image_source: source,\n            search_query: searchQuery\n        }).select().single();\n        if (error) {\n            // If it's a unique constraint violation, that's ok - image is already tracked\n            if (error.code === \"23505\") {\n                console.log(`â„¹ï¸ Image already tracked for this article`);\n                return null;\n            }\n            console.error(\"Error tracking image usage:\", error);\n            throw error;\n        }\n        return data;\n    } catch (error) {\n        console.error(\"Error in trackImageUsage:\", error);\n        // Don't throw - image tracking shouldn't break the enrichment process\n        return null;\n    }\n}\nasync function getRecentlyUsedImages(days = 30, category) {\n    try {\n        const cutoffDate = new Date();\n        cutoffDate.setDate(cutoffDate.getDate() - days);\n        let query = supabaseAdmin.from(\"perplexity_image_history\").select(\"image_url, image_source, category, used_at\").gte(\"used_at\", cutoffDate.toISOString()).order(\"used_at\", {\n            ascending: false\n        });\n        if (category) {\n            query = query.eq(\"category\", category);\n        }\n        const { data, error } = await query;\n        if (error) {\n            // If table doesn't exist yet, return empty array\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.log(\"Image history table not yet created\");\n                return [];\n            }\n            throw error;\n        }\n        // Create a map of unique images with their usage count\n        const imageMap = new Map();\n        data?.forEach((record)=>{\n            const key = record.image_url;\n            if (imageMap.has(key)) {\n                const existing = imageMap.get(key);\n                existing.count++;\n                if (new Date(record.used_at) > existing.lastUsed) {\n                    existing.lastUsed = new Date(record.used_at);\n                }\n            } else {\n                imageMap.set(key, {\n                    source: record.image_source,\n                    count: 1,\n                    lastUsed: new Date(record.used_at)\n                });\n            }\n        });\n        // Convert to array and sort by usage count and recency\n        const recentImages = Array.from(imageMap.entries()).map(([url, info])=>({\n                image_url: url,\n                image_source: info.source,\n                used_count: info.count,\n                last_used: info.lastUsed\n            }));\n        console.log(`ðŸ“Š Found ${recentImages.length} unique images used in last ${days} days${category ? ` for category ${category}` : \"\"}`);\n        return recentImages;\n    } catch (error) {\n        console.error(\"Error fetching recently used images:\", error);\n        return [];\n    }\n}\nasync function isImageRecentlyUsed(imageUrl, days = 7) {\n    try {\n        const cutoffDate = new Date();\n        cutoffDate.setDate(cutoffDate.getDate() - days);\n        const { data, error } = await supabaseAdmin.from(\"perplexity_image_history\").select(\"id\").eq(\"image_url\", imageUrl).gte(\"used_at\", cutoffDate.toISOString()).limit(1);\n        if (error) {\n            // If table doesn't exist, return false\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                return false;\n            }\n            throw error;\n        }\n        return (data?.length || 0) > 0;\n    } catch (error) {\n        console.error(\"Error checking if image recently used:\", error);\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQW9EO0FBRXBELE1BQU1DLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxxQkFBcUJILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRWhFLElBQUksQ0FBQ0wsYUFBYTtJQUNoQixNQUFNLElBQUlNLE1BQU07QUFDbEI7QUFFQSxJQUFJLENBQUNGLG9CQUFvQjtJQUN2QixNQUFNLElBQUlFLE1BQU07QUFDbEI7QUFFQSxnRUFBZ0U7QUFDekQsTUFBTUMsZ0JBQWdCUixtRUFBWUEsQ0FBQ0MsYUFBYUksb0JBQW9CO0lBQ3pFSSxNQUFNO1FBQ0pDLGtCQUFrQjtRQUNsQkMsZ0JBQWdCO0lBQ2xCO0FBQ0YsR0FBRTtBQUVGLGtEQUFrRDtBQUN4QjtBQUcxQiw4REFBOEQ7QUFDdkQsZUFBZUMsd0JBQXdCQyxTQUFxRTtJQUNqSCxJQUFJO1FBQ0ZDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLHNCQUFzQixFQUFFRixVQUFVRyxNQUFNLENBQUMsb0NBQW9DLENBQUM7UUFFM0YsZ0NBQWdDO1FBQ2hDSCxVQUFVSSxPQUFPLENBQUMsQ0FBQ0MsVUFBVUM7WUFDM0JMLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRUksSUFBSSxFQUFFLEdBQUcsRUFBRUQsU0FBU0UsUUFBUSxDQUFDLEVBQUUsRUFBRUYsU0FBU0csS0FBSyxDQUFDLENBQUM7WUFDbEVQLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFVBQVUsRUFBRUcsU0FBU0ksR0FBRyxDQUFDLENBQUM7WUFDdkNSLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGFBQWEsRUFBRUcsU0FBU0ssY0FBYyxDQUFDLENBQUM7UUFDdkQ7UUFFQSwwRUFBMEU7UUFDMUUsTUFBTUMsaUJBQWlCLEVBQUU7UUFDekIsTUFBTUMsaUJBQWlCLEVBQUU7UUFFekIsS0FBSyxNQUFNUCxZQUFZTCxVQUFXO1lBQ2hDLElBQUk7Z0JBQ0Ysa0ZBQWtGO2dCQUNsRixNQUFNLEVBQUVhLFlBQVksRUFBRSxHQUFHQyxjQUFjLEdBQUdUO2dCQUUxQyxNQUFNLEVBQUVVLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTXJCLGNBQzNCc0IsSUFBSSxDQUFDLG1CQUNMQyxNQUFNLENBQUNKLGNBQ1BLLE1BQU0sR0FDTkMsTUFBTTtnQkFFVCxJQUFJSixPQUFPO29CQUNULElBQUlBLE1BQU1LLElBQUksS0FBSyxTQUFTO3dCQUMxQlQsZUFBZVUsSUFBSSxDQUFDakIsU0FBU0csS0FBSztvQkFDcEMsT0FBTzt3QkFDTFAsUUFBUWUsS0FBSyxDQUFDLENBQUMseUJBQXlCLEVBQUVYLFNBQVNHLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBRVEsTUFBTU8sT0FBTztvQkFDN0U7Z0JBQ0YsT0FBTztvQkFDTFosZUFBZVcsSUFBSSxDQUFDUDtnQkFDdEI7WUFDRixFQUFFLE9BQU9TLEtBQUs7Z0JBQ1p2QixRQUFRZSxLQUFLLENBQUMsQ0FBQyxvQ0FBb0MsRUFBRVgsU0FBU0csS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFZ0I7WUFDM0U7UUFDRjtRQUVBdkIsUUFBUUMsR0FBRyxDQUFDLENBQUMsK0JBQStCLENBQUM7UUFDN0NELFFBQVFDLEdBQUcsQ0FBQyxDQUFDLHlCQUF5QixFQUFFRixVQUFVRyxNQUFNLENBQUMsQ0FBQztRQUMxREYsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0JBQXdCLEVBQUVTLGVBQWVSLE1BQU0sQ0FBQyxDQUFDO1FBQzlERixRQUFRQyxHQUFHLENBQUMsQ0FBQyx3QkFBd0IsRUFBRVUsZUFBZVQsTUFBTSxDQUFDLENBQUM7UUFFOUQsSUFBSVEsZUFBZVIsTUFBTSxHQUFHLEdBQUc7WUFDN0JGLFFBQVFDLEdBQUcsQ0FBQyxxQ0FBMkJTLGVBQWVjLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUMsRUFBRTtRQUNyRTtRQUVBLElBQUlmLGVBQWVULE1BQU0sR0FBRyxHQUFHO1lBQzdCRixRQUFRQyxHQUFHLENBQUMsNkNBQW1DVSxlQUFlZ0IsS0FBSyxDQUFDLEdBQUcsR0FBR0gsR0FBRyxDQUFDakIsQ0FBQUEsUUFBUyxDQUFDLENBQUMsRUFBRUEsTUFBTSxDQUFDLENBQUMsRUFBRXFCLElBQUksQ0FBQztRQUM1RztRQUVBLE9BQU87WUFBRWQsTUFBTUo7WUFBZ0JtQixPQUFPbkIsZUFBZVIsTUFBTTtRQUFDO0lBQzlELEVBQUUsT0FBT2EsT0FBTztRQUNkZixRQUFRZSxLQUFLLENBQUM7UUFDZGYsUUFBUWUsS0FBSyxDQUFDLG1CQUFtQkEsTUFBTWUsV0FBVyxDQUFDQyxJQUFJO1FBQ3ZEL0IsUUFBUWUsS0FBSyxDQUFDLHNCQUFzQkEsTUFBTU8sT0FBTztRQUNqRHRCLFFBQVFlLEtBQUssQ0FBQyxvQkFBb0JBLE1BQU1pQixLQUFLO1FBQzdDLE1BQU1qQjtJQUNSO0FBQ0Y7QUFFTyxlQUFla0IseUJBQXlCQyxRQUFRLEVBQUU7SUFDdkQsSUFBSTtRQUNGbEMsUUFBUUMsR0FBRyxDQUFDLENBQUMsK0NBQStDLEVBQUVpQyxNQUFNLCtCQUErQixDQUFDO1FBQ3BHLE1BQU0sRUFBRXBCLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTXJCLGNBQzNCc0IsSUFBSSxDQUFDLG1CQUNMRSxNQUFNLENBQUMsS0FDUGlCLEVBQUUsQ0FBQyw0RUFDSEMsS0FBSyxDQUFDLGNBQWM7WUFBRUMsV0FBVztRQUFLLEdBQ3RDSCxLQUFLLENBQUNBO1FBRVQsSUFBSW5CLE9BQU87WUFDVCxJQUFJQSxNQUFNSyxJQUFJLEtBQUssV0FBV0wsTUFBTU8sT0FBTyxDQUFDZ0IsUUFBUSxDQUFDLG1CQUFtQjtnQkFDdEV0QyxRQUFRdUMsSUFBSSxDQUFDO2dCQUNiLE9BQU8sRUFBRTtZQUNYO1lBQ0EsTUFBTXhCO1FBQ1I7UUFFQWYsUUFBUUMsR0FBRyxDQUFDLENBQUMsbUNBQW1DLEVBQUVhLE1BQU1aLFVBQVUsRUFBRSxpQkFBaUIsQ0FBQztRQUN0RixJQUFJWSxNQUFNWixRQUFRO1lBQ2hCWSxLQUFLWCxPQUFPLENBQUMsQ0FBQ3FDLFNBQVNuQztnQkFDckJMLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRUksSUFBSSxFQUFFLEdBQUcsRUFBRW1DLFFBQVFsQyxRQUFRLENBQUMsRUFBRSxFQUFFa0MsUUFBUWpDLEtBQUssQ0FBQyxFQUFFLEVBQUVpQyxRQUFRL0IsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUM5RjtRQUNGO1FBRUEsT0FBT0ssUUFBUSxFQUFFO0lBQ25CLEVBQUUsT0FBT0MsT0FBTztRQUNkZixRQUFRZSxLQUFLLENBQUMsMkNBQTJDQTtRQUN6RCxPQUFPLEVBQUU7SUFDWDtBQUNGO0FBRU8sZUFBZTBCLHdCQUF3QmYsRUFBVSxFQUFFZ0IsT0FBZ0M7SUFDeEYsSUFBSTtRQUNGLE1BQU0sRUFBRTVCLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTXJCLGNBQzNCc0IsSUFBSSxDQUFDLG1CQUNMMkIsTUFBTSxDQUFDRCxTQUNQRSxFQUFFLENBQUMsTUFBTWxCLElBQ1RSLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlKLE9BQU87WUFDVCxzREFBc0Q7WUFDdEQsSUFBSUEsTUFBTUssSUFBSSxLQUFLLGNBQWNMLE1BQU1PLE9BQU8sQ0FBQ2dCLFFBQVEsQ0FBQyxtQkFBbUI7Z0JBQ3pFdEMsUUFBUXVDLElBQUksQ0FBQztnQkFFYiwrREFBK0Q7Z0JBQy9ELE1BQU1NLGdCQUFnQkMsT0FBT0MsV0FBVyxDQUN0Q0QsT0FBT0UsT0FBTyxDQUFDTixTQUFTTyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxJQUFJLEdBQ25DLENBQUM7d0JBQUM7d0JBQWtCO3dCQUFXO3dCQUFjO3dCQUFrQjtxQkFBcUIsQ0FBQ1osUUFBUSxDQUFDWTtnQkFJbEcsSUFBSUosT0FBT0ssSUFBSSxDQUFDTixlQUFlM0MsTUFBTSxHQUFHLEdBQUc7b0JBQ3pDRixRQUFRQyxHQUFHLENBQUMsa0RBQXdDNkMsT0FBT0ssSUFBSSxDQUFDTjtvQkFDaEUsTUFBTSxFQUFFL0IsTUFBTXNDLFVBQVUsRUFBRXJDLE9BQU9zQyxXQUFXLEVBQUUsR0FBRyxNQUFNM0QsY0FDcERzQixJQUFJLENBQUMsbUJBQ0wyQixNQUFNLENBQUNFLGVBQ1BELEVBQUUsQ0FBQyxNQUFNbEIsSUFDVFIsTUFBTSxHQUNOQyxNQUFNO29CQUVULElBQUlrQyxhQUFhO3dCQUNmckQsUUFBUWUsS0FBSyxDQUFDLHNDQUFzQ3NDO3dCQUNwRCxNQUFNQTtvQkFDUjtvQkFFQSxPQUFPRDtnQkFDVDtZQUNGO1lBRUFwRCxRQUFRZSxLQUFLLENBQUMsc0NBQXNDQTtZQUNwRCxNQUFNQTtRQUNSO1FBRUEsT0FBT0Q7SUFDVCxFQUFFLE9BQU9DLE9BQU87UUFDZGYsUUFBUWUsS0FBSyxDQUFDLHFDQUFxQ0E7UUFDbkQsTUFBTUE7SUFDUjtBQUNGO0FBRU8sZUFBZXVDLGtCQUFrQmhELFFBQWlCLEVBQUU0QixRQUFRLEVBQUU7SUFDbkUsSUFBSTtRQUNGLElBQUlxQixRQUFRN0QsY0FDVHNCLElBQUksQ0FBQyxtQkFDTEUsTUFBTSxDQUFDLEtBQ1BzQyxFQUFFLENBQUMsa0JBQWtCO1lBQUM7WUFBUztZQUFXO1NBQVcsRUFBRSwrQkFBK0I7U0FDdEZwQixLQUFLLENBQUMsY0FBYztZQUFFQyxXQUFXO1FBQU07UUFFMUMsSUFBSS9CLFVBQVU7WUFDWmlELFFBQVFBLE1BQU1YLEVBQUUsQ0FBQyxZQUFZdEM7UUFDL0I7UUFFQSxNQUFNLEVBQUVRLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTXdDLE1BQU1yQixLQUFLLENBQUNBO1FBRTFDLElBQUluQixPQUFPO1lBQ1QsSUFBSUEsTUFBTUssSUFBSSxLQUFLLFdBQVdMLE1BQU1PLE9BQU8sQ0FBQ2dCLFFBQVEsQ0FBQyxtQkFBbUI7Z0JBQ3RFdEMsUUFBUXVDLElBQUksQ0FBQztnQkFDYixPQUFPLEVBQUU7WUFDWDtZQUNBLE1BQU14QjtRQUNSO1FBRUFmLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDRCQUE0QixFQUFFYSxNQUFNWixVQUFVLEVBQUUsd0JBQXdCLEVBQUVJLFlBQVksTUFBTSxDQUFDO1FBQzFHLE9BQU9RLFFBQVEsRUFBRTtJQUNuQixFQUFFLE9BQU9DLE9BQU87UUFDZGYsUUFBUWUsS0FBSyxDQUFDLG1DQUFtQ0E7UUFDakQsT0FBTyxFQUFFO0lBQ1g7QUFDRjtBQUVPLGVBQWUwQywwQkFBMEJDLE9BQU8sQ0FBQztJQUN0RCxJQUFJO1FBQ0YsTUFBTUMsYUFBYSxJQUFJQztRQUN2QkQsV0FBV0UsT0FBTyxDQUFDRixXQUFXRyxPQUFPLEtBQUtKO1FBRTFDMUQsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0RBQXdELEVBQUV5RCxLQUFLLFFBQVEsQ0FBQztRQUNyRixNQUFNLEVBQUU1QyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1yQixjQUMzQnNCLElBQUksQ0FBQyxtQkFDTEUsTUFBTSxDQUFDLG1CQUNQNkMsR0FBRyxDQUFDLGNBQWNKLFdBQVdLLFdBQVcsSUFDeEM1QixLQUFLLENBQUMsY0FBYztZQUFFQyxXQUFXO1FBQU07UUFFMUMsSUFBSXRCLE9BQU87WUFDVCxJQUFJQSxNQUFNSyxJQUFJLEtBQUssV0FBV0wsTUFBTU8sT0FBTyxDQUFDZ0IsUUFBUSxDQUFDLG1CQUFtQjtnQkFDdEV0QyxRQUFRdUMsSUFBSSxDQUFDO2dCQUNiLE9BQU8sRUFBRTtZQUNYO1lBQ0EsTUFBTXhCO1FBQ1I7UUFFQWYsUUFBUUMsR0FBRyxDQUFDLENBQUMsb0NBQW9DLEVBQUVhLE1BQU1aLFVBQVUsRUFBRSxjQUFjLENBQUM7UUFDcEYsT0FBT1ksUUFBUSxFQUFFO0lBQ25CLEVBQUUsT0FBT0MsT0FBTztRQUNkZixRQUFRZSxLQUFLLENBQUMsNENBQTRDQTtRQUMxRCxPQUFPLEVBQUU7SUFDWDtBQUNGO0FBRU8sZUFBZWtELDRCQUE0QkMsbUJBQTJCLEVBQUU7SUFDN0UsSUFBSTtRQUNGbEUsUUFBUUMsR0FBRyxDQUFDO1FBQ1osTUFBTSxFQUFFYSxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1yQixjQUMzQnNCLElBQUksQ0FBQyxtQkFDTEUsTUFBTSxDQUFDLEtBQ1BzQyxFQUFFLENBQUMsa0JBQWtCO1lBQUM7WUFBUztZQUFXO1NBQVcsRUFBRSwrQkFBK0I7U0FDdEZXLEdBQUcsQ0FBQyxVQUFVLDRCQUE0Qiw0QkFBNEI7U0FDdEUvQixLQUFLLENBQUMsY0FBYztZQUFFQyxXQUFXO1FBQU07UUFFMUMsSUFBSXRCLE9BQU87WUFDVCxJQUFJQSxNQUFNSyxJQUFJLEtBQUssV0FBV0wsTUFBTU8sT0FBTyxDQUFDZ0IsUUFBUSxDQUFDLG1CQUFtQjtnQkFDdEV0QyxRQUFRdUMsSUFBSSxDQUFDO2dCQUNiLE9BQU8sQ0FBQztZQUNWO1lBQ0EsTUFBTXhCO1FBQ1I7UUFFQWYsUUFBUUMsR0FBRyxDQUFDLENBQUMsc0NBQXNDLEVBQUVhLE1BQU1aLFVBQVUsRUFBRSxlQUFlLENBQUM7UUFFdkYsNENBQTRDO1FBQzVDLE1BQU1rRSxjQUFjLENBQUN0RCxRQUFRLEVBQUUsRUFBRXVELE1BQU0sQ0FBQyxDQUFDQyxLQUFLOUI7WUFDNUMsSUFBSSxDQUFDOEIsR0FBRyxDQUFDOUIsUUFBUWxDLFFBQVEsQ0FBQyxFQUFFO2dCQUMxQmdFLEdBQUcsQ0FBQzlCLFFBQVFsQyxRQUFRLENBQUMsR0FBRyxFQUFFO1lBQzVCO1lBQ0EsOERBQThEO1lBQzlELElBQUk0RCxxQkFBcUIsS0FBS0ksR0FBRyxDQUFDOUIsUUFBUWxDLFFBQVEsQ0FBQyxDQUFDSixNQUFNLEdBQUdnRSxrQkFBa0I7Z0JBQzdFSSxHQUFHLENBQUM5QixRQUFRbEMsUUFBUSxDQUFDLENBQUNlLElBQUksQ0FBQ21CO1lBQzdCO1lBQ0EsT0FBTzhCO1FBQ1QsR0FBRyxDQUFDO1FBRUp0RSxRQUFRQyxHQUFHLENBQUMsQ0FBQyx3REFBd0QsQ0FBQyxFQUFFNkMsT0FBT0ssSUFBSSxDQUFDaUI7UUFDcEZ0QixPQUFPSyxJQUFJLENBQUNpQixhQUFhakUsT0FBTyxDQUFDb0UsQ0FBQUE7WUFDL0J2RSxRQUFRQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUVzRSxJQUFJLEVBQUUsRUFBRUgsV0FBVyxDQUFDRyxJQUFJLENBQUNyRSxNQUFNLENBQUMsU0FBUyxDQUFDO1FBQy9EO1FBRUEsT0FBT2tFO0lBQ1QsRUFBRSxPQUFPckQsT0FBTztRQUNkZixRQUFRZSxLQUFLLENBQUMsK0NBQStDQTtRQUM3RCxPQUFPLENBQUM7SUFDVjtBQUNGO0FBRU8sZUFBZXlEO0lBQ3BCLDJDQUEyQztJQUMzQyxPQUFPUCw0QkFBNEI7QUFDckM7QUFFTyxlQUFlUTtJQUNwQixJQUFJO1FBQ0YsTUFBTSxFQUFFM0QsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNckIsY0FDM0JzQixJQUFJLENBQUMsbUJBQ0xFLE1BQU0sQ0FBQyxNQUNQZ0IsS0FBSyxDQUFDO1FBRVQsSUFBSW5CLE9BQU87WUFDVCxJQUFJQSxNQUFNSyxJQUFJLEtBQUssV0FBV0wsTUFBTU8sT0FBTyxDQUFDZ0IsUUFBUSxDQUFDLG1CQUFtQjtnQkFDdEUsT0FBTztZQUNUO1lBQ0EsTUFBTXZCO1FBQ1I7UUFFQSxPQUFPO0lBQ1QsRUFBRSxPQUFPQSxPQUFPO1FBQ2RmLFFBQVFlLEtBQUssQ0FBQyw2Q0FBNkNBO1FBQzNELE9BQU87SUFDVDtBQUNGO0FBRUEsbUNBQW1DO0FBQzVCLGVBQWUyRCxnQkFBZ0JDLFFBQWdCLEVBQUVDLFNBQWlCLEVBQUV0RSxRQUFnQixFQUFFdUUsTUFBYyxFQUFFQyxXQUFvQjtJQUMvSCxJQUFJO1FBQ0Y5RSxRQUFRQyxHQUFHLENBQUMsQ0FBQyx5QkFBeUIsRUFBRTBFLFNBQVMsYUFBYSxFQUFFQyxVQUFVLENBQUM7UUFFM0UsTUFBTSxFQUFFOUQsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNckIsY0FDM0JzQixJQUFJLENBQUMsNEJBQ0xDLE1BQU0sQ0FBQztZQUNOOEQsV0FBV0o7WUFDWEssWUFBWUo7WUFDWnRFO1lBQ0EyRSxjQUFjSjtZQUNkSyxjQUFjSjtRQUNoQixHQUNDNUQsTUFBTSxHQUNOQyxNQUFNO1FBRVQsSUFBSUosT0FBTztZQUNULDhFQUE4RTtZQUM5RSxJQUFJQSxNQUFNSyxJQUFJLEtBQUssU0FBUztnQkFDMUJwQixRQUFRQyxHQUFHLENBQUMsQ0FBQyx5Q0FBeUMsQ0FBQztnQkFDdkQsT0FBTztZQUNUO1lBQ0FELFFBQVFlLEtBQUssQ0FBQywrQkFBK0JBO1lBQzdDLE1BQU1BO1FBQ1I7UUFFQSxPQUFPRDtJQUNULEVBQUUsT0FBT0MsT0FBTztRQUNkZixRQUFRZSxLQUFLLENBQUMsNkJBQTZCQTtRQUMzQyxzRUFBc0U7UUFDdEUsT0FBTztJQUNUO0FBQ0Y7QUFFTyxlQUFlb0Usc0JBQXNCekIsT0FBTyxFQUFFLEVBQUVwRCxRQUFpQjtJQUN0RSxJQUFJO1FBQ0YsTUFBTXFELGFBQWEsSUFBSUM7UUFDdkJELFdBQVdFLE9BQU8sQ0FBQ0YsV0FBV0csT0FBTyxLQUFLSjtRQUUxQyxJQUFJSCxRQUFRN0QsY0FDVHNCLElBQUksQ0FBQyw0QkFDTEUsTUFBTSxDQUFDLDhDQUNQNkMsR0FBRyxDQUFDLFdBQVdKLFdBQVdLLFdBQVcsSUFDckM1QixLQUFLLENBQUMsV0FBVztZQUFFQyxXQUFXO1FBQU07UUFFdkMsSUFBSS9CLFVBQVU7WUFDWmlELFFBQVFBLE1BQU1YLEVBQUUsQ0FBQyxZQUFZdEM7UUFDL0I7UUFFQSxNQUFNLEVBQUVRLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTXdDO1FBRTlCLElBQUl4QyxPQUFPO1lBQ1QsaURBQWlEO1lBQ2pELElBQUlBLE1BQU1LLElBQUksS0FBSyxXQUFXTCxNQUFNTyxPQUFPLENBQUNnQixRQUFRLENBQUMsbUJBQW1CO2dCQUN0RXRDLFFBQVFDLEdBQUcsQ0FBQztnQkFDWixPQUFPLEVBQUU7WUFDWDtZQUNBLE1BQU1jO1FBQ1I7UUFFQSx1REFBdUQ7UUFDdkQsTUFBTXFFLFdBQVcsSUFBSUM7UUFFckJ2RSxNQUFNWCxRQUFRbUYsQ0FBQUE7WUFDWixNQUFNcEMsTUFBTW9DLE9BQU9QLFNBQVM7WUFDNUIsSUFBSUssU0FBU0csR0FBRyxDQUFDckMsTUFBTTtnQkFDckIsTUFBTXNDLFdBQVdKLFNBQVNLLEdBQUcsQ0FBQ3ZDO2dCQUM5QnNDLFNBQVMzRCxLQUFLO2dCQUNkLElBQUksSUFBSStCLEtBQUswQixPQUFPSSxPQUFPLElBQUlGLFNBQVNHLFFBQVEsRUFBRTtvQkFDaERILFNBQVNHLFFBQVEsR0FBRyxJQUFJL0IsS0FBSzBCLE9BQU9JLE9BQU87Z0JBQzdDO1lBQ0YsT0FBTztnQkFDTE4sU0FBU1EsR0FBRyxDQUFDMUMsS0FBSztvQkFDaEIyQixRQUFRUyxPQUFPTCxZQUFZO29CQUMzQnBELE9BQU87b0JBQ1A4RCxVQUFVLElBQUkvQixLQUFLMEIsT0FBT0ksT0FBTztnQkFDbkM7WUFDRjtRQUNGO1FBRUEsdURBQXVEO1FBQ3ZELE1BQU1HLGVBQWVDLE1BQU05RSxJQUFJLENBQUNvRSxTQUFTcEMsT0FBTyxJQUFJeEIsR0FBRyxDQUFDLENBQUMsQ0FBQ2hCLEtBQUt1RixLQUFLLEdBQU07Z0JBQ3hFaEIsV0FBV3ZFO2dCQUNYeUUsY0FBY2MsS0FBS2xCLE1BQU07Z0JBQ3pCbUIsWUFBWUQsS0FBS2xFLEtBQUs7Z0JBQ3RCb0UsV0FBV0YsS0FBS0osUUFBUTtZQUMxQjtRQUVBM0YsUUFBUUMsR0FBRyxDQUFDLENBQUMsU0FBUyxFQUFFNEYsYUFBYTNGLE1BQU0sQ0FBQyw0QkFBNEIsRUFBRXdELEtBQUssS0FBSyxFQUFFcEQsV0FBVyxDQUFDLGNBQWMsRUFBRUEsU0FBUyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBRW5JLE9BQU91RjtJQUNULEVBQUUsT0FBTzlFLE9BQU87UUFDZGYsUUFBUWUsS0FBSyxDQUFDLHdDQUF3Q0E7UUFDdEQsT0FBTyxFQUFFO0lBQ1g7QUFDRjtBQUVPLGVBQWVtRixvQkFBb0J2QixRQUFnQixFQUFFakIsT0FBTyxDQUFDO0lBQ2xFLElBQUk7UUFDRixNQUFNQyxhQUFhLElBQUlDO1FBQ3ZCRCxXQUFXRSxPQUFPLENBQUNGLFdBQVdHLE9BQU8sS0FBS0o7UUFFMUMsTUFBTSxFQUFFNUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNckIsY0FDM0JzQixJQUFJLENBQUMsNEJBQ0xFLE1BQU0sQ0FBQyxNQUNQMEIsRUFBRSxDQUFDLGFBQWErQixVQUNoQlosR0FBRyxDQUFDLFdBQVdKLFdBQVdLLFdBQVcsSUFDckM5QixLQUFLLENBQUM7UUFFVCxJQUFJbkIsT0FBTztZQUNULHVDQUF1QztZQUN2QyxJQUFJQSxNQUFNSyxJQUFJLEtBQUssV0FBV0wsTUFBTU8sT0FBTyxDQUFDZ0IsUUFBUSxDQUFDLG1CQUFtQjtnQkFDdEUsT0FBTztZQUNUO1lBQ0EsTUFBTXZCO1FBQ1I7UUFFQSxPQUFPLENBQUNELE1BQU1aLFVBQVUsS0FBSztJQUMvQixFQUFFLE9BQU9hLE9BQU87UUFDZGYsUUFBUWUsS0FBSyxDQUFDLDBDQUEwQ0E7UUFDeEQsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oa2ktem9uZS8uL2xpYi9zdXBhYmFzZS1zZXJ2ZXIudHM/MDk0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCJcblxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhXG5jb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuXG5pZiAoIXN1cGFiYXNlVXJsKSB7XG4gIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgZW52aXJvbm1lbnQgdmFyaWFibGUnKVxufVxuXG5pZiAoIXN1cGFiYXNlU2VydmljZUtleSkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZScpXG59XG5cbi8vIFNlcnZlci1vbmx5IGNsaWVudCB3aXRoIHNlcnZpY2Ugcm9sZSBrZXkgZm9yIGFkbWluIG9wZXJhdGlvbnNcbmV4cG9ydCBjb25zdCBzdXBhYmFzZUFkbWluID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXksIHtcbiAgYXV0aDoge1xuICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxuICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZVxuICB9XG59KVxuXG4vLyBSZS1leHBvcnQgdHlwZXMgYW5kIGludGVyZmFjZXMgZm9yIGNvbnZlbmllbmNlIFxuZXhwb3J0ICogZnJvbSAnLi9zdXBhYmFzZSdcbmltcG9ydCB0eXBlIHsgUGVycGxleGl0eU5ld3MgfSBmcm9tICcuL3N1cGFiYXNlJ1xuXG4vLyBTZXJ2ZXItc2lkZSBQZXJwbGV4aXR5IGZ1bmN0aW9ucyB0aGF0IG5lZWQgYWRtaW4gcHJpdmlsZWdlc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmVQZXJwbGV4aXR5SGVhZGxpbmVzKGhlYWRsaW5lczogT21pdDxQZXJwbGV4aXR5TmV3cywgJ2lkJyB8ICdjcmVhdGVkX2F0JyB8ICd1cGRhdGVkX2F0Jz5bXSkge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGDwn5K+IEF0dGVtcHRpbmcgdG8gc2F2ZSAke2hlYWRsaW5lcy5sZW5ndGh9IFBlcnBsZXhpdHkgaGVhZGxpbmVzIHRvIGRhdGFiYXNlLi4uYClcbiAgICBcbiAgICAvLyBMb2cgZWFjaCBoZWFkbGluZSBiZWluZyBzYXZlZFxuICAgIGhlYWRsaW5lcy5mb3JFYWNoKChoZWFkbGluZSwgaSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYCAgJHtpICsgMX0uIFske2hlYWRsaW5lLmNhdGVnb3J5fV0gJHtoZWFkbGluZS50aXRsZX1gKVxuICAgICAgY29uc29sZS5sb2coYCAgICAgVVJMOiAke2hlYWRsaW5lLnVybH1gKVxuICAgICAgY29uc29sZS5sb2coYCAgICAgU3RhdHVzOiAke2hlYWRsaW5lLmFydGljbGVfc3RhdHVzfWApXG4gICAgfSlcblxuICAgIC8vIEluc2VydCBoZWFkbGluZXMgb25lIGJ5IG9uZSB0byBnZXQgYWNjdXJhdGUgY291bnQgb2Ygc3VjY2Vzc2Z1bCBpbnNlcnRzXG4gICAgY29uc3Qgc2F2ZWRIZWFkbGluZXMgPSBbXVxuICAgIGNvbnN0IGR1cGxpY2F0ZUNvdW50ID0gW11cbiAgICBcbiAgICBmb3IgKGNvbnN0IGhlYWRsaW5lIG9mIGhlYWRsaW5lcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gUmVtb3ZlIHB1Ymxpc2hlZF9hdCBmaWVsZCBpZiBwcmVzZW50ICh1c2luZyBvbmx5IGNyZWF0ZWRfYXQvdXBkYXRlZF9hdCBwYXR0ZXJuKVxuICAgICAgICBjb25zdCB7IHB1Ymxpc2hlZF9hdCwgLi4uaGVhZGxpbmVEYXRhIH0gPSBoZWFkbGluZSBhcyBhbnlcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgICAuZnJvbShcInBlcnBsZXhpdHlfbmV3c1wiKVxuICAgICAgICAgIC5pbnNlcnQoaGVhZGxpbmVEYXRhKVxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5zaW5nbGUoKVxuXG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGlmIChlcnJvci5jb2RlID09PSAnMjM1MDUnKSB7IC8vIFVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvblxuICAgICAgICAgICAgZHVwbGljYXRlQ291bnQucHVzaChoZWFkbGluZS50aXRsZSlcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIHNhdmluZyBoZWFkbGluZSBcIiR7aGVhZGxpbmUudGl0bGV9XCI6YCwgZXJyb3IubWVzc2FnZSlcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2F2ZWRIZWFkbGluZXMucHVzaChkYXRhKVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIFVuZXhwZWN0ZWQgZXJyb3Igc2F2aW5nIGhlYWRsaW5lIFwiJHtoZWFkbGluZS50aXRsZX1cIjpgLCBlcnIpXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYOKchSBEYXRhYmFzZSBvcGVyYXRpb24gY29tcGxldGVkOmApXG4gICAgY29uc29sZS5sb2coYCAgLSBIZWFkbGluZXMgZ2VuZXJhdGVkOiAke2hlYWRsaW5lcy5sZW5ndGh9YClcbiAgICBjb25zb2xlLmxvZyhgICAtIFN1Y2Nlc3NmdWxseSBzYXZlZDogJHtzYXZlZEhlYWRsaW5lcy5sZW5ndGh9YClcbiAgICBjb25zb2xlLmxvZyhgICAtIER1cGxpY2F0ZXMgc2tpcHBlZDogJHtkdXBsaWNhdGVDb3VudC5sZW5ndGh9YClcbiAgICBcbiAgICBpZiAoc2F2ZWRIZWFkbGluZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coXCLwn5OLIFNhdmVkIGhlYWRsaW5lcyBJRHM6XCIsIHNhdmVkSGVhZGxpbmVzLm1hcChoID0+IGguaWQpKVxuICAgIH1cbiAgICBcbiAgICBpZiAoZHVwbGljYXRlQ291bnQubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coXCLwn5SEIER1cGxpY2F0ZSBoZWFkbGluZXMgc2tpcHBlZDpcIiwgZHVwbGljYXRlQ291bnQuc2xpY2UoMCwgMykubWFwKHRpdGxlID0+IGBcIiR7dGl0bGV9XCJgKS5qb2luKFwiLCBcIikpXG4gICAgfVxuXG4gICAgcmV0dXJuIHsgZGF0YTogc2F2ZWRIZWFkbGluZXMsIGNvdW50OiBzYXZlZEhlYWRsaW5lcy5sZW5ndGggfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLwn5KlIENyaXRpY2FsIGVycm9yIGluIHNhdmVQZXJwbGV4aXR5SGVhZGxpbmVzOlwiKVxuICAgIGNvbnNvbGUuZXJyb3IoXCIgIC0gRXJyb3IgdHlwZTpcIiwgZXJyb3IuY29uc3RydWN0b3IubmFtZSlcbiAgICBjb25zb2xlLmVycm9yKFwiICAtIEVycm9yIG1lc3NhZ2U6XCIsIGVycm9yLm1lc3NhZ2UpXG4gICAgY29uc29sZS5lcnJvcihcIiAgLSBFcnJvciBzdGFjazpcIiwgZXJyb3Iuc3RhY2spXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UGVuZGluZ1BlcnBsZXhpdHlOZXdzKGxpbWl0ID0gMTApIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBnZXRQZW5kaW5nUGVycGxleGl0eU5ld3M6IExvb2tpbmcgZm9yIHVwIHRvICR7bGltaXR9IGFydGljbGVzIG5lZWRpbmcgcHJvY2Vzc2luZy4uLmApXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oXCJwZXJwbGV4aXR5X25ld3NcIilcbiAgICAgIC5zZWxlY3QoXCIqXCIpXG4gICAgICAub3IoXCJhcnRpY2xlX3N0YXR1cy5lcS5wZW5kaW5nLGltYWdlX3N0YXR1cy5lcS5mYWlsZWQsaW1hZ2Vfc3RhdHVzLmVxLnBlbmRpbmdcIilcbiAgICAgIC5vcmRlcihcImNyZWF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IHRydWUgfSlcbiAgICAgIC5saW1pdChsaW1pdClcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFwiNDJQMDFcIiB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiUGVycGxleGl0eSBuZXdzIHRhYmxlIGRvZXMgbm90IGV4aXN0LiBQbGVhc2UgcnVuIHRoZSBkYXRhYmFzZSBzZXR1cC5cIilcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGDwn5OKIGdldFBlbmRpbmdQZXJwbGV4aXR5TmV3czogRm91bmQgJHtkYXRhPy5sZW5ndGggfHwgMH0gcGVuZGluZyBhcnRpY2xlc2ApXG4gICAgaWYgKGRhdGE/Lmxlbmd0aCkge1xuICAgICAgZGF0YS5mb3JFYWNoKChhcnRpY2xlLCBpKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICR7aSArIDF9LiBbJHthcnRpY2xlLmNhdGVnb3J5fV0gJHthcnRpY2xlLnRpdGxlfSAoJHthcnRpY2xlLmFydGljbGVfc3RhdHVzfSlgKVxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YSB8fCBbXVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBwZW5kaW5nIFBlcnBsZXhpdHkgbmV3czpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIFtdXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVBlcnBsZXhpdHlBcnRpY2xlKGlkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8UGVycGxleGl0eU5ld3M+KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oXCJwZXJwbGV4aXR5X25ld3NcIilcbiAgICAgIC51cGRhdGUodXBkYXRlcylcbiAgICAgIC5lcShcImlkXCIsIGlkKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhlIGVycm9yIGlzIGFib3V0IG1pc3NpbmcgZW5oYW5jZWQgZmllbGRzXG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ1BHUlNUMjA0JyAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdlbmhhbmNlZF90aXRsZScpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyAgRW5oYW5jZWQgZmllbGRzIG5vdCBhdmFpbGFibGUgaW4gc2NoZW1hLCB1c2luZyBsZWdhY3kgZmllbGRzIG9ubHlcIilcbiAgICAgICAgXG4gICAgICAgIC8vIEZpbHRlciBvdXQgZW5oYW5jZWQgZmllbGRzIGFuZCByZXRyeSB3aXRoIGxlZ2FjeSBmaWVsZHMgb25seVxuICAgICAgICBjb25zdCBsZWdhY3lVcGRhdGVzID0gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHVwZGF0ZXMpLmZpbHRlcigoW2tleV0pID0+IFxuICAgICAgICAgICAgIVsnZW5oYW5jZWRfdGl0bGUnLCAnc3VtbWFyeScsICdrZXlfcG9pbnRzJywgJ3doeV9pdF9tYXR0ZXJzJywgJ3N0cnVjdHVyZWRfc291cmNlcyddLmluY2x1ZGVzKGtleSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhsZWdhY3lVcGRhdGVzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCLwn5SEIFJldHJ5aW5nIHdpdGggbGVnYWN5IGZpZWxkcyBvbmx5OlwiLCBPYmplY3Qua2V5cyhsZWdhY3lVcGRhdGVzKSlcbiAgICAgICAgICBjb25zdCB7IGRhdGE6IGxlZ2FjeURhdGEsIGVycm9yOiBsZWdhY3lFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgICAgICAgLmZyb20oXCJwZXJwbGV4aXR5X25ld3NcIilcbiAgICAgICAgICAgIC51cGRhdGUobGVnYWN5VXBkYXRlcylcbiAgICAgICAgICAgIC5lcShcImlkXCIsIGlkKVxuICAgICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgICAuc2luZ2xlKClcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAobGVnYWN5RXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB3aXRoIGxlZ2FjeSBmaWVsZHM6XCIsIGxlZ2FjeUVycm9yKVxuICAgICAgICAgICAgdGhyb3cgbGVnYWN5RXJyb3JcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIGxlZ2FjeURhdGFcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgUGVycGxleGl0eSBhcnRpY2xlOlwiLCBlcnJvcilcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGFcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW4gdXBkYXRlUGVycGxleGl0eUFydGljbGU6XCIsIGVycm9yKVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBlcnBsZXhpdHlOZXdzKGNhdGVnb3J5Pzogc3RyaW5nLCBsaW1pdCA9IDIwKSB7XG4gIHRyeSB7XG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oXCJwZXJwbGV4aXR5X25ld3NcIilcbiAgICAgIC5zZWxlY3QoXCIqXCIpXG4gICAgICAuaW4oXCJhcnRpY2xlX3N0YXR1c1wiLCBbXCJyZWFkeVwiLCBcInBlbmRpbmdcIiwgXCJlbnJpY2hlZFwiXSkgLy8gSW5jbHVkZSBhbGwgc3RhdHVzZXMgZm9yIG5vd1xuICAgICAgLm9yZGVyKFwidXBkYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblxuICAgIGlmIChjYXRlZ29yeSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcShcImNhdGVnb3J5XCIsIGNhdGVnb3J5KVxuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5LmxpbWl0KGxpbWl0KVxuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gXCI0MlAwMVwiIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJkb2VzIG5vdCBleGlzdFwiKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJQZXJwbGV4aXR5IG5ld3MgdGFibGUgZG9lcyBub3QgZXhpc3QuIFBsZWFzZSBydW4gdGhlIGRhdGFiYXNlIHNldHVwLlwiKVxuICAgICAgICByZXR1cm4gW11cbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfk4ogZ2V0UGVycGxleGl0eU5ld3M6IEZvdW5kICR7ZGF0YT8ubGVuZ3RoIHx8IDB9IGFydGljbGVzIGZvciBjYXRlZ29yeTogJHtjYXRlZ29yeSB8fCAnYWxsJ31gKVxuICAgIHJldHVybiBkYXRhIHx8IFtdXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIFBlcnBsZXhpdHkgbmV3czpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIFtdXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJlY2VudFBlcnBsZXhpdHlUaXRsZXMoZGF5cyA9IDcpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjdXRvZmZEYXRlID0gbmV3IERhdGUoKVxuICAgIGN1dG9mZkRhdGUuc2V0RGF0ZShjdXRvZmZEYXRlLmdldERhdGUoKSAtIGRheXMpXG4gICAgXG4gICAgY29uc29sZS5sb2coYPCfk4ogZ2V0UmVjZW50UGVycGxleGl0eVRpdGxlczogRmV0Y2hpbmcgdGl0bGVzIGZyb20gbGFzdCAke2RheXN9IGRheXMuLi5gKVxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKFwicGVycGxleGl0eV9uZXdzXCIpXG4gICAgICAuc2VsZWN0KFwidGl0bGUsIGNhdGVnb3J5XCIpXG4gICAgICAuZ3RlKFwiY3JlYXRlZF9hdFwiLCBjdXRvZmZEYXRlLnRvSVNPU3RyaW5nKCkpXG4gICAgICAub3JkZXIoXCJjcmVhdGVkX2F0XCIsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgIFxuICAgIGlmIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFwiNDJQMDFcIiB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiUGVycGxleGl0eSBuZXdzIHRhYmxlIGRvZXMgbm90IGV4aXN0LiBQbGVhc2UgcnVuIHRoZSBkYXRhYmFzZSBzZXR1cC5cIilcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBnZXRSZWNlbnRQZXJwbGV4aXR5VGl0bGVzOiBGb3VuZCAke2RhdGE/Lmxlbmd0aCB8fCAwfSByZWNlbnQgdGl0bGVzYClcbiAgICByZXR1cm4gZGF0YSB8fCBbXVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyByZWNlbnQgUGVycGxleGl0eSB0aXRsZXM6XCIsIGVycm9yKVxuICAgIHJldHVybiBbXVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQZXJwbGV4aXR5TmV3c0J5Q2F0ZWdvcnkobGltaXRQZXJDYXRlZ29yeTogbnVtYmVyID0gMTApIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhcIvCfk4ogZ2V0UGVycGxleGl0eU5ld3NCeUNhdGVnb3J5OiBGZXRjaGluZyBhbGwgYXJ0aWNsZXMuLi5cIilcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbShcInBlcnBsZXhpdHlfbmV3c1wiKVxuICAgICAgLnNlbGVjdChcIipcIilcbiAgICAgIC5pbihcImFydGljbGVfc3RhdHVzXCIsIFtcInJlYWR5XCIsIFwicGVuZGluZ1wiLCBcImVucmljaGVkXCJdKSAvLyBJbmNsdWRlIGFsbCBzdGF0dXNlcyBmb3Igbm93XG4gICAgICAubmVxKFwic291cmNlXCIsIFwiUGVycGxleGl0eSBBSSAoRmFsbGJhY2spXCIpIC8vIEV4Y2x1ZGUgZmFsbGJhY2sgYXJ0aWNsZXNcbiAgICAgIC5vcmRlcihcInVwZGF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSBcIjQyUDAxXCIgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImRvZXMgbm90IGV4aXN0XCIpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIlBlcnBsZXhpdHkgbmV3cyB0YWJsZSBkb2VzIG5vdCBleGlzdC4gUGxlYXNlIHJ1biB0aGUgZGF0YWJhc2Ugc2V0dXAuXCIpXG4gICAgICAgIHJldHVybiB7fVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+TiiBnZXRQZXJwbGV4aXR5TmV3c0J5Q2F0ZWdvcnk6IEZvdW5kICR7ZGF0YT8ubGVuZ3RoIHx8IDB9IHRvdGFsIGFydGljbGVzYClcblxuICAgIC8vIEdyb3VwIGJ5IGNhdGVnb3J5IHdpdGggY29uZmlndXJhYmxlIGxpbWl0XG4gICAgY29uc3QgZ3JvdXBlZE5ld3MgPSAoZGF0YSB8fCBbXSkucmVkdWNlKChhY2MsIGFydGljbGUpID0+IHtcbiAgICAgIGlmICghYWNjW2FydGljbGUuY2F0ZWdvcnldKSB7XG4gICAgICAgIGFjY1thcnRpY2xlLmNhdGVnb3J5XSA9IFtdXG4gICAgICB9XG4gICAgICAvLyBBcHBseSBsaW1pdCBvbmx5IGlmIGxpbWl0UGVyQ2F0ZWdvcnkgPiAwICgwIG1lYW5zIG5vIGxpbWl0KVxuICAgICAgaWYgKGxpbWl0UGVyQ2F0ZWdvcnkgPT09IDAgfHwgYWNjW2FydGljbGUuY2F0ZWdvcnldLmxlbmd0aCA8IGxpbWl0UGVyQ2F0ZWdvcnkpIHtcbiAgICAgICAgYWNjW2FydGljbGUuY2F0ZWdvcnldLnB1c2goYXJ0aWNsZSlcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2NcbiAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBQZXJwbGV4aXR5TmV3c1tdPilcblxuICAgIGNvbnNvbGUubG9nKGDwn5OKIGdldFBlcnBsZXhpdHlOZXdzQnlDYXRlZ29yeTogR3JvdXBlZCBpbnRvIGNhdGVnb3JpZXM6YCwgT2JqZWN0LmtleXMoZ3JvdXBlZE5ld3MpKVxuICAgIE9iamVjdC5rZXlzKGdyb3VwZWROZXdzKS5mb3JFYWNoKGNhdCA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgICAtICR7Y2F0fTogJHtncm91cGVkTmV3c1tjYXRdLmxlbmd0aH0gYXJ0aWNsZXNgKVxuICAgIH0pXG5cbiAgICByZXR1cm4gZ3JvdXBlZE5ld3NcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgUGVycGxleGl0eSBuZXdzIGJ5IGNhdGVnb3J5OlwiLCBlcnJvcilcbiAgICByZXR1cm4ge31cbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UGVycGxleGl0eU5ld3NCeUNhdGVnb3J5QWRtaW4oKSB7XG4gIC8vIEFkbWluIHZlcnNpb24gd2l0aCBubyBwZXItY2F0ZWdvcnkgbGltaXRcbiAgcmV0dXJuIGdldFBlcnBsZXhpdHlOZXdzQnlDYXRlZ29yeSgwKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tQZXJwbGV4aXR5TmV3c1RhYmxlU2V0dXAoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oXCJwZXJwbGV4aXR5X25ld3NcIilcbiAgICAgIC5zZWxlY3QoXCJpZFwiKVxuICAgICAgLmxpbWl0KDEpXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSBcIjQyUDAxXCIgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImRvZXMgbm90IGV4aXN0XCIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJQZXJwbGV4aXR5IG5ld3MgdGFibGUgc2V0dXAgY2hlY2sgZmFpbGVkOlwiLCBlcnJvcilcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuXG4vLyBJbWFnZSBoaXN0b3J5IHRyYWNraW5nIGZ1bmN0aW9uc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRyYWNrSW1hZ2VVc2FnZShpbWFnZVVybDogc3RyaW5nLCBhcnRpY2xlSWQ6IHN0cmluZywgY2F0ZWdvcnk6IHN0cmluZywgc291cmNlOiBzdHJpbmcsIHNlYXJjaFF1ZXJ5Pzogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYPCfk7ggVHJhY2tpbmcgaW1hZ2UgdXNhZ2U6ICR7aW1hZ2VVcmx9IGZvciBhcnRpY2xlICR7YXJ0aWNsZUlkfWApXG4gICAgXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oXCJwZXJwbGV4aXR5X2ltYWdlX2hpc3RvcnlcIilcbiAgICAgIC5pbnNlcnQoe1xuICAgICAgICBpbWFnZV91cmw6IGltYWdlVXJsLFxuICAgICAgICBhcnRpY2xlX2lkOiBhcnRpY2xlSWQsXG4gICAgICAgIGNhdGVnb3J5LFxuICAgICAgICBpbWFnZV9zb3VyY2U6IHNvdXJjZSxcbiAgICAgICAgc2VhcmNoX3F1ZXJ5OiBzZWFyY2hRdWVyeVxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIElmIGl0J3MgYSB1bmlxdWUgY29uc3RyYWludCB2aW9sYXRpb24sIHRoYXQncyBvayAtIGltYWdlIGlzIGFscmVhZHkgdHJhY2tlZFxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKEue+4jyBJbWFnZSBhbHJlYWR5IHRyYWNrZWQgZm9yIHRoaXMgYXJ0aWNsZWApXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgICB9XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdHJhY2tpbmcgaW1hZ2UgdXNhZ2U6XCIsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiB0cmFja0ltYWdlVXNhZ2U6XCIsIGVycm9yKVxuICAgIC8vIERvbid0IHRocm93IC0gaW1hZ2UgdHJhY2tpbmcgc2hvdWxkbid0IGJyZWFrIHRoZSBlbnJpY2htZW50IHByb2Nlc3NcbiAgICByZXR1cm4gbnVsbFxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSZWNlbnRseVVzZWRJbWFnZXMoZGF5cyA9IDMwLCBjYXRlZ29yeT86IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZSgpXG4gICAgY3V0b2ZmRGF0ZS5zZXREYXRlKGN1dG9mZkRhdGUuZ2V0RGF0ZSgpIC0gZGF5cylcbiAgICBcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbShcInBlcnBsZXhpdHlfaW1hZ2VfaGlzdG9yeVwiKVxuICAgICAgLnNlbGVjdChcImltYWdlX3VybCwgaW1hZ2Vfc291cmNlLCBjYXRlZ29yeSwgdXNlZF9hdFwiKVxuICAgICAgLmd0ZShcInVzZWRfYXRcIiwgY3V0b2ZmRGF0ZS50b0lTT1N0cmluZygpKVxuICAgICAgLm9yZGVyKFwidXNlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICBcbiAgICBpZiAoY2F0ZWdvcnkpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoXCJjYXRlZ29yeVwiLCBjYXRlZ29yeSlcbiAgICB9XG4gICAgXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnlcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gSWYgdGFibGUgZG9lc24ndCBleGlzdCB5ZXQsIHJldHVybiBlbXB0eSBhcnJheVxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFwiNDJQMDFcIiB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJJbWFnZSBoaXN0b3J5IHRhYmxlIG5vdCB5ZXQgY3JlYXRlZFwiKVxuICAgICAgICByZXR1cm4gW11cbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGEgbWFwIG9mIHVuaXF1ZSBpbWFnZXMgd2l0aCB0aGVpciB1c2FnZSBjb3VudFxuICAgIGNvbnN0IGltYWdlTWFwID0gbmV3IE1hcDxzdHJpbmcsIHsgc291cmNlOiBzdHJpbmcsIGNvdW50OiBudW1iZXIsIGxhc3RVc2VkOiBEYXRlIH0+KClcbiAgICBcbiAgICBkYXRhPy5mb3JFYWNoKHJlY29yZCA9PiB7XG4gICAgICBjb25zdCBrZXkgPSByZWNvcmQuaW1hZ2VfdXJsXG4gICAgICBpZiAoaW1hZ2VNYXAuaGFzKGtleSkpIHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBpbWFnZU1hcC5nZXQoa2V5KSFcbiAgICAgICAgZXhpc3RpbmcuY291bnQrK1xuICAgICAgICBpZiAobmV3IERhdGUocmVjb3JkLnVzZWRfYXQpID4gZXhpc3RpbmcubGFzdFVzZWQpIHtcbiAgICAgICAgICBleGlzdGluZy5sYXN0VXNlZCA9IG5ldyBEYXRlKHJlY29yZC51c2VkX2F0KVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbWFnZU1hcC5zZXQoa2V5LCB7XG4gICAgICAgICAgc291cmNlOiByZWNvcmQuaW1hZ2Vfc291cmNlLFxuICAgICAgICAgIGNvdW50OiAxLFxuICAgICAgICAgIGxhc3RVc2VkOiBuZXcgRGF0ZShyZWNvcmQudXNlZF9hdClcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgLy8gQ29udmVydCB0byBhcnJheSBhbmQgc29ydCBieSB1c2FnZSBjb3VudCBhbmQgcmVjZW5jeVxuICAgIGNvbnN0IHJlY2VudEltYWdlcyA9IEFycmF5LmZyb20oaW1hZ2VNYXAuZW50cmllcygpKS5tYXAoKFt1cmwsIGluZm9dKSA9PiAoe1xuICAgICAgaW1hZ2VfdXJsOiB1cmwsXG4gICAgICBpbWFnZV9zb3VyY2U6IGluZm8uc291cmNlLFxuICAgICAgdXNlZF9jb3VudDogaW5mby5jb3VudCxcbiAgICAgIGxhc3RfdXNlZDogaW5mby5sYXN0VXNlZFxuICAgIH0pKVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5OKIEZvdW5kICR7cmVjZW50SW1hZ2VzLmxlbmd0aH0gdW5pcXVlIGltYWdlcyB1c2VkIGluIGxhc3QgJHtkYXlzfSBkYXlzJHtjYXRlZ29yeSA/IGAgZm9yIGNhdGVnb3J5ICR7Y2F0ZWdvcnl9YCA6ICcnfWApXG4gICAgXG4gICAgcmV0dXJuIHJlY2VudEltYWdlc1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyByZWNlbnRseSB1c2VkIGltYWdlczpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIFtdXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzSW1hZ2VSZWNlbnRseVVzZWQoaW1hZ2VVcmw6IHN0cmluZywgZGF5cyA9IDcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjdXRvZmZEYXRlID0gbmV3IERhdGUoKVxuICAgIGN1dG9mZkRhdGUuc2V0RGF0ZShjdXRvZmZEYXRlLmdldERhdGUoKSAtIGRheXMpXG4gICAgXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oXCJwZXJwbGV4aXR5X2ltYWdlX2hpc3RvcnlcIilcbiAgICAgIC5zZWxlY3QoXCJpZFwiKVxuICAgICAgLmVxKFwiaW1hZ2VfdXJsXCIsIGltYWdlVXJsKVxuICAgICAgLmd0ZShcInVzZWRfYXRcIiwgY3V0b2ZmRGF0ZS50b0lTT1N0cmluZygpKVxuICAgICAgLmxpbWl0KDEpXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIElmIHRhYmxlIGRvZXNuJ3QgZXhpc3QsIHJldHVybiBmYWxzZVxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFwiNDJQMDFcIiB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cblxuICAgIHJldHVybiAoZGF0YT8ubGVuZ3RoIHx8IDApID4gMFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjaGVja2luZyBpZiBpbWFnZSByZWNlbnRseSB1c2VkOlwiLCBlcnJvcilcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufSJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiRXJyb3IiLCJzdXBhYmFzZUFkbWluIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsInNhdmVQZXJwbGV4aXR5SGVhZGxpbmVzIiwiaGVhZGxpbmVzIiwiY29uc29sZSIsImxvZyIsImxlbmd0aCIsImZvckVhY2giLCJoZWFkbGluZSIsImkiLCJjYXRlZ29yeSIsInRpdGxlIiwidXJsIiwiYXJ0aWNsZV9zdGF0dXMiLCJzYXZlZEhlYWRsaW5lcyIsImR1cGxpY2F0ZUNvdW50IiwicHVibGlzaGVkX2F0IiwiaGVhZGxpbmVEYXRhIiwiZGF0YSIsImVycm9yIiwiZnJvbSIsImluc2VydCIsInNlbGVjdCIsInNpbmdsZSIsImNvZGUiLCJwdXNoIiwibWVzc2FnZSIsImVyciIsIm1hcCIsImgiLCJpZCIsInNsaWNlIiwiam9pbiIsImNvdW50IiwiY29uc3RydWN0b3IiLCJuYW1lIiwic3RhY2siLCJnZXRQZW5kaW5nUGVycGxleGl0eU5ld3MiLCJsaW1pdCIsIm9yIiwib3JkZXIiLCJhc2NlbmRpbmciLCJpbmNsdWRlcyIsIndhcm4iLCJhcnRpY2xlIiwidXBkYXRlUGVycGxleGl0eUFydGljbGUiLCJ1cGRhdGVzIiwidXBkYXRlIiwiZXEiLCJsZWdhY3lVcGRhdGVzIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJlbnRyaWVzIiwiZmlsdGVyIiwia2V5Iiwia2V5cyIsImxlZ2FjeURhdGEiLCJsZWdhY3lFcnJvciIsImdldFBlcnBsZXhpdHlOZXdzIiwicXVlcnkiLCJpbiIsImdldFJlY2VudFBlcnBsZXhpdHlUaXRsZXMiLCJkYXlzIiwiY3V0b2ZmRGF0ZSIsIkRhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImd0ZSIsInRvSVNPU3RyaW5nIiwiZ2V0UGVycGxleGl0eU5ld3NCeUNhdGVnb3J5IiwibGltaXRQZXJDYXRlZ29yeSIsIm5lcSIsImdyb3VwZWROZXdzIiwicmVkdWNlIiwiYWNjIiwiY2F0IiwiZ2V0UGVycGxleGl0eU5ld3NCeUNhdGVnb3J5QWRtaW4iLCJjaGVja1BlcnBsZXhpdHlOZXdzVGFibGVTZXR1cCIsInRyYWNrSW1hZ2VVc2FnZSIsImltYWdlVXJsIiwiYXJ0aWNsZUlkIiwic291cmNlIiwic2VhcmNoUXVlcnkiLCJpbWFnZV91cmwiLCJhcnRpY2xlX2lkIiwiaW1hZ2Vfc291cmNlIiwic2VhcmNoX3F1ZXJ5IiwiZ2V0UmVjZW50bHlVc2VkSW1hZ2VzIiwiaW1hZ2VNYXAiLCJNYXAiLCJyZWNvcmQiLCJoYXMiLCJleGlzdGluZyIsImdldCIsInVzZWRfYXQiLCJsYXN0VXNlZCIsInNldCIsInJlY2VudEltYWdlcyIsIkFycmF5IiwiaW5mbyIsInVzZWRfY291bnQiLCJsYXN0X3VzZWQiLCJpc0ltYWdlUmVjZW50bHlVc2VkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase-server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkDatabaseSetup: () => (/* binding */ checkDatabaseSetup),\n/* harmony export */   checkHeadlinesTableSetup: () => (/* binding */ checkHeadlinesTableSetup),\n/* harmony export */   checkPerplexityNewsTableSetup: () => (/* binding */ checkPerplexityNewsTableSetup),\n/* harmony export */   cleanupOldHeadlines: () => (/* binding */ cleanupOldHeadlines),\n/* harmony export */   getArticleById: () => (/* binding */ getArticleById),\n/* harmony export */   getArticleStats: () => (/* binding */ getArticleStats),\n/* harmony export */   getArticles: () => (/* binding */ getArticles),\n/* harmony export */   getArticlesRegular: () => (/* binding */ getArticlesRegular),\n/* harmony export */   getBalancedArticles: () => (/* binding */ getBalancedArticles),\n/* harmony export */   getEnhancementStats: () => (/* binding */ getEnhancementStats),\n/* harmony export */   getHeadlines: () => (/* binding */ getHeadlines),\n/* harmony export */   getHeadlinesByCategory: () => (/* binding */ getHeadlinesByCategory),\n/* harmony export */   getPerplexityNews: () => (/* binding */ getPerplexityNews),\n/* harmony export */   getPerplexityNewsByCategory: () => (/* binding */ getPerplexityNewsByCategory),\n/* harmony export */   saveArticle: () => (/* binding */ saveArticle),\n/* harmony export */   saveHeadlines: () => (/* binding */ saveHeadlines),\n/* harmony export */   searchArticles: () => (/* binding */ searchArticles),\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = \"https://egyuetfeubznhcvmtary.supabase.co\";\n// Use service role key for server-side operations, anon key for client-side\nconst supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVneXVldGZldWJ6bmhjdm10YXJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzNzUwMDUsImV4cCI6MjA2Njk1MTAwNX0.0Pp5fprFclRqGciWqI4BusTro6wgxXCFWpI6AaKH0tw\";\nif (!supabaseUrl) {\n    throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n}\nif (!supabaseKey) {\n    throw new Error(\"Missing SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable\");\n}\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseKey);\nasync function saveArticle(article) {\n    try {\n        // Check if article already exists by URL\n        const { data: existing } = await supabase.from(\"articles\").select(\"id, title, created_at\").eq(\"url\", article.url).single();\n        if (existing) {\n            console.log(`â­ï¸  Article already exists (skipping): ${article.title}`);\n            console.log(`   ðŸ“… Originally saved: ${new Date(existing.created_at).toLocaleString()}`);\n            return {\n                ...existing,\n                skipped: true\n            };\n        }\n        // Insert new article\n        const { data, error } = await supabase.from(\"articles\").insert([\n            {\n                title: article.title,\n                content: article.content,\n                summary: article.summary,\n                ai_summary: article.ai_summary,\n                url: article.url,\n                source: article.source,\n                author: article.author,\n                image_url: article.imageUrl || article.image_url,\n                category: article.category || \"General\",\n                is_ai_enhanced: article.is_ai_enhanced || false,\n                original_article_id: article.original_article_id,\n                enhancement_metadata: article.enhancement_metadata\n            }\n        ]).select().single();\n        if (error) {\n            console.error(\"Error saving article:\", error);\n            throw error;\n        }\n        console.log(`âœ… Saved new article: ${article.title}`);\n        return {\n            ...data,\n            skipped: false\n        };\n    } catch (error) {\n        console.error(\"Error in saveArticle:\", error);\n        throw error;\n    }\n}\nasync function getArticleStats() {\n    try {\n        const { data, error } = await supabase.from(\"articles\").select(\"source, created_at\").order(\"created_at\", {\n            ascending: false\n        });\n        if (error) {\n            console.error(\"Error fetching article stats:\", error);\n            return null;\n        }\n        const stats = {\n            total: data.length,\n            bySource: {},\n            latest: data[0]?.created_at,\n            oldest: data[data.length - 1]?.created_at\n        };\n        // Count by source\n        data.forEach((article)=>{\n            stats.bySource[article.source] = (stats.bySource[article.source] || 0) + 1;\n        });\n        return stats;\n    } catch (error) {\n        console.error(\"Error getting article stats:\", error);\n        return null;\n    }\n}\n// Balanced query function to ensure proportional representation from all sources\nasync function getBalancedArticles(page = 0, limit = 10, filters) {\n    try {\n        // If specific source or category filter is applied, use regular query\n        if (filters?.source || filters?.category) {\n            return getArticlesRegular(page, limit, filters);\n        }\n        // Define known sources and their desired proportions\n        const sources = [\n            \"HK01\",\n            \"on.cc\",\n            \"SingTao\",\n            \"RTHK\",\n            \"HKFP\",\n            \"ONCC\",\n            \"am730\",\n            \"scmp\",\n            \"bloomberg\"\n        ];\n        const articlesPerSource = Math.max(1, Math.floor(limit / sources.length));\n        const extraArticles = limit % sources.length;\n        const allArticles = [];\n        // Get articles from each source proportionally with proper pagination\n        for(let i = 0; i < sources.length; i++){\n            const source = sources[i];\n            const sourceLimit = articlesPerSource + (i < extraArticles ? 1 : 0);\n            let query = supabase.from(\"articles\").select(\"*\").in(\"source\", [\n                source,\n                `${source} (AI Enhanced)`\n            ]).order(\"created_at\", {\n                ascending: false\n            });\n            // Apply AI enhanced filter if specified\n            if (filters?.isAiEnhanced !== undefined) {\n                query = query.eq(\"is_ai_enhanced\", filters.isAiEnhanced);\n            }\n            // Apply language filter if specified - use only metadata (language column doesn't exist)\n            if (filters?.language) {\n                if (filters.language !== \"en\") {\n                    // For non-English languages, check metadata language\n                    query = query.eq(\"enhancement_metadata->>language\", filters.language);\n                } else {\n                    // For English, include articles where metadata shows 'en' OR metadata language is null/missing\n                    query = query.or(`enhancement_metadata->>language.eq.en,enhancement_metadata->>language.is.null`);\n                }\n            }\n            // Use proper pagination with range instead of limit + slice\n            const startIndex = sourceLimit * page;\n            const endIndex = startIndex + sourceLimit - 1;\n            const { data, error } = await query.range(startIndex, endIndex);\n            if (!error && data) {\n                allArticles.push(...data);\n            }\n        }\n        // Sort the mixed articles by creation date (newest first)\n        allArticles.sort((a, b)=>new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\n        return allArticles.slice(0, limit);\n    } catch (error) {\n        console.error(\"Error fetching balanced articles:\", error);\n        // Fallback to regular query\n        return getArticlesRegular(page, limit, filters);\n    }\n}\n// Original query function (renamed for clarity)\nasync function getArticlesRegular(page = 0, limit = 10, filters) {\n    try {\n        let query = supabase.from(\"articles\").select(\"*\").order(\"created_at\", {\n            ascending: false\n        });\n        // Apply filters if provided\n        if (filters?.source) {\n            query = query.eq(\"source\", filters.source);\n        }\n        if (filters?.category) {\n            query = query.eq(\"category\", filters.category);\n        }\n        if (filters?.isAiEnhanced !== undefined) {\n            query = query.eq(\"is_ai_enhanced\", filters.isAiEnhanced);\n        }\n        // Apply language filter if specified - use only metadata (language column doesn't exist)\n        if (filters?.language) {\n            if (filters.language !== \"en\") {\n                // For non-English languages, check metadata language\n                query = query.eq(\"enhancement_metadata->>language\", filters.language);\n            } else {\n                // For English, include articles where metadata shows 'en' OR metadata language is null/missing\n                query = query.or(`enhancement_metadata->>language.eq.en,enhancement_metadata->>language.is.null`);\n            }\n        }\n        if (filters?.hasEnrichment !== undefined) {\n            if (filters.hasEnrichment) {\n                query = query.not(\"ai_summary\", \"is\", null);\n            } else {\n                query = query.is(\"ai_summary\", null);\n            }\n        }\n        const { data, error } = await query.range(page * limit, (page + 1) * limit - 1);\n        if (error) {\n            // If table doesn't exist, return empty array instead of throwing\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Articles table does not exist. Please run the database setup.\");\n                return [];\n            }\n            throw error;\n        }\n        return data || [];\n    } catch (error) {\n        console.error(\"Error fetching articles:\", error);\n        return [];\n    }\n}\n// Main export - use regular query for better pagination reliability\nasync function getArticles(page = 0, limit = 10, filters) {\n    return getArticlesRegular(page, limit, filters);\n}\nasync function searchArticles(query) {\n    try {\n        const { data, error } = await supabase.from(\"articles\").select(\"*\").or(`title.ilike.%${query}%,summary.ilike.%${query}%,ai_summary.ilike.%${query}%`).order(\"created_at\", {\n            ascending: false\n        }).limit(20);\n        if (error) {\n            // If table doesn't exist, return empty array instead of throwing\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Articles table does not exist. Please run the database setup.\");\n                return [];\n            }\n            throw error;\n        }\n        return data || [];\n    } catch (error) {\n        console.error(\"Error searching articles:\", error);\n        return [];\n    }\n}\nasync function getArticleById(id) {\n    try {\n        console.log(`ðŸ“ getArticleById called with ID: ${id}`);\n        const { data, error } = await supabase.from(\"articles\").select(\"*\").eq(\"id\", id).single();\n        if (error) {\n            console.error(`âŒ Error fetching article ${id}:`, error);\n            // If not found, log sample IDs for debugging\n            if (error.code === \"PGRST116\") {\n                const { data: sampleArticles } = await supabase.from(\"articles\").select(\"id\").limit(5);\n                console.log(\"\\uD83D\\uDCCB Sample article IDs in database:\", sampleArticles?.map((a)=>a.id));\n            }\n            // If table doesn't exist, return null instead of throwing\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Articles table does not exist. Please run the database setup.\");\n                return null;\n            }\n            throw error;\n        }\n        console.log(`âœ… Found article: ${data.title}`);\n        return data;\n    } catch (error) {\n        console.error(\"Error fetching article by ID:\", error);\n        return null;\n    }\n}\n// Function to get enhancement statistics\nasync function getEnhancementStats() {\n    try {\n        const { data, error } = await supabase.rpc(\"get_enhancement_stats\");\n        if (error) {\n            console.error(\"Error fetching enhancement stats:\", error);\n            return null;\n        }\n        return data?.[0] || null;\n    } catch (error) {\n        console.error(\"Error getting enhancement stats:\", error);\n        return null;\n    }\n}\n// Function to check if database is set up\nasync function checkDatabaseSetup() {\n    try {\n        console.log(\"Checking database setup...\");\n        // Add timeout to prevent hanging requests\n        const timeoutPromise = new Promise((_, reject)=>setTimeout(()=>reject(new Error(\"Database check timeout\")), 3000));\n        // Try to select from articles table with timeout\n        const dbPromise = supabase.from(\"articles\").select(\"id\").limit(1);\n        const { data, error } = await Promise.race([\n            dbPromise,\n            timeoutPromise\n        ]);\n        console.log(\"Database check result:\", {\n            data,\n            error\n        });\n        if (error) {\n            console.error(\"Database check error:\", error);\n            // Check for specific error codes that indicate table doesn't exist\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\") || error.message.includes(\"relation\") || error.message.includes(\"table\")) {\n                return false;\n            }\n            // Check for RLS/permission errors (common after enabling Realtime)\n            if (error.code === \"42501\" || error.message.includes(\"permission denied\") || error.message.includes(\"RLS\") || error.message.includes(\"policy\")) {\n                console.warn(\"Database exists but RLS policies may be blocking access\");\n                return false;\n            }\n            // For other errors, assume table exists but there might be permission issues\n            return true;\n        }\n        console.log(\"Database setup check passed\");\n        return true;\n    } catch (error) {\n        console.error(\"Database setup check failed:\", error);\n        // Handle timeout and other errors\n        if (error.message === \"Database check timeout\") {\n            console.warn(\"Database check timed out - likely RLS policy issue\");\n        }\n        return false;\n    }\n}\nasync function saveHeadlines(headlines) {\n    try {\n        const { data, error } = await supabase.from(\"headlines\").insert(headlines).select();\n        if (error) {\n            console.error(\"Error saving headlines:\", error);\n            throw error;\n        }\n        console.log(`âœ… Saved ${headlines.length} headlines`);\n        return data;\n    } catch (error) {\n        console.error(\"Error in saveHeadlines:\", error);\n        throw error;\n    }\n}\nasync function getHeadlines(category) {\n    try {\n        let query = supabase.from(\"headlines\").select(\"*\").order(\"created_at\", {\n            ascending: false\n        });\n        if (category) {\n            query = query.eq(\"category\", category);\n        }\n        const { data, error } = await query;\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Headlines table does not exist. Please run the database setup.\");\n                return [];\n            }\n            throw error;\n        }\n        return data || [];\n    } catch (error) {\n        console.error(\"Error fetching headlines:\", error);\n        return [];\n    }\n}\nasync function getHeadlinesByCategory() {\n    try {\n        const { data, error } = await supabase.from(\"headlines\").select(\"*\").order(\"created_at\", {\n            ascending: false\n        });\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Headlines table does not exist. Please run the database setup.\");\n                return {};\n            }\n            throw error;\n        }\n        // Group headlines by category (max 10 per category)\n        const groupedHeadlines = (data || []).reduce((acc, headline)=>{\n            if (!acc[headline.category]) {\n                acc[headline.category] = [];\n            }\n            if (acc[headline.category].length < 10) {\n                acc[headline.category].push(headline);\n            }\n            return acc;\n        }, {});\n        return groupedHeadlines;\n    } catch (error) {\n        console.error(\"Error fetching headlines by category:\", error);\n        return {};\n    }\n}\nasync function cleanupOldHeadlines() {\n    try {\n        const { error } = await supabase.from(\"headlines\").delete().lt(\"created_at\", new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString());\n        if (error) {\n            console.error(\"Error cleaning up old headlines:\", error);\n            throw error;\n        }\n        console.log(\"âœ… Cleaned up old headlines\");\n    } catch (error) {\n        console.error(\"Error in cleanupOldHeadlines:\", error);\n        throw error;\n    }\n}\nasync function checkHeadlinesTableSetup() {\n    try {\n        const { data, error } = await supabase.from(\"headlines\").select(\"id\").limit(1);\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                return false;\n            }\n            throw error;\n        }\n        return true;\n    } catch (error) {\n        console.error(\"Headlines table setup check failed:\", error);\n        return false;\n    }\n}\nasync function getPerplexityNews(category, limit = 20) {\n    try {\n        let query = supabase.from(\"perplexity_news\").select(\"*\").eq(\"article_status\", \"ready\").order(\"updated_at\", {\n            ascending: false\n        });\n        if (category) {\n            query = query.eq(\"category\", category);\n        }\n        const { data, error } = await query.limit(limit);\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Perplexity news table does not exist. Please run the database setup.\");\n                return [];\n            }\n            throw error;\n        }\n        return data || [];\n    } catch (error) {\n        console.error(\"Error fetching Perplexity news:\", error);\n        return [];\n    }\n}\nasync function getPerplexityNewsByCategory() {\n    try {\n        const { data, error } = await supabase.from(\"perplexity_news\").select(\"*\").eq(\"article_status\", \"ready\").order(\"updated_at\", {\n            ascending: false\n        });\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                console.warn(\"Perplexity news table does not exist. Please run the database setup.\");\n                return {};\n            }\n            throw error;\n        }\n        // Group by category (max 10 per category)\n        const groupedNews = (data || []).reduce((acc, article)=>{\n            if (!acc[article.category]) {\n                acc[article.category] = [];\n            }\n            if (acc[article.category].length < 10) {\n                acc[article.category].push(article);\n            }\n            return acc;\n        }, {});\n        return groupedNews;\n    } catch (error) {\n        console.error(\"Error fetching Perplexity news by category:\", error);\n        return {};\n    }\n}\nasync function checkPerplexityNewsTableSetup() {\n    try {\n        const { data, error } = await supabase.from(\"perplexity_news\").select(\"id\").limit(1);\n        if (error) {\n            if (error.code === \"42P01\" || error.message.includes(\"does not exist\")) {\n                return false;\n            }\n            throw error;\n        }\n        return true;\n    } catch (error) {\n        console.error(\"Perplexity news table setup check failed:\", error);\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUVKLE9BQU9VO0lBQ1QsRUFBRSxPQUFPM0YsT0FBTztRQUNkUCxRQUFRTyxLQUFLLENBQUMsK0NBQStDQTtRQUM3RCxPQUFPLENBQUM7SUFDVjtBQUNGO0FBRU8sZUFBZTRGO0lBQ3BCLElBQUk7UUFDRixNQUFNLEVBQUUxRyxJQUFJLEVBQUVjLEtBQUssRUFBRSxHQUFHLE1BQU1qQixTQUMzQkssSUFBSSxDQUFDLG1CQUNMQyxNQUFNLENBQUMsTUFDUG9DLEtBQUssQ0FBQztRQUVULElBQUl6QixPQUFPO1lBQ1QsSUFBSUEsTUFBTXVELElBQUksS0FBSyxXQUFXdkQsTUFBTXdELE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLG1CQUFtQjtnQkFDdEUsT0FBTztZQUNUO1lBQ0EsTUFBTXpEO1FBQ1I7UUFFQSxPQUFPO0lBQ1QsRUFBRSxPQUFPQSxPQUFPO1FBQ2RQLFFBQVFPLEtBQUssQ0FBQyw2Q0FBNkNBO1FBQzNELE9BQU87SUFDVDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGtpLXpvbmUvLi9saWIvc3VwYWJhc2UudHM/Yzk5ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCJcblxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhXG4vLyBVc2Ugc2VydmljZSByb2xlIGtleSBmb3Igc2VydmVyLXNpZGUgb3BlcmF0aW9ucywgYW5vbiBrZXkgZm9yIGNsaWVudC1zaWRlXG5jb25zdCBzdXBhYmFzZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgfHwgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhXG5cbmlmICghc3VwYWJhc2VVcmwpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZScpXG59XG5cbmlmICghc3VwYWJhc2VLZXkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgb3IgTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgZW52aXJvbm1lbnQgdmFyaWFibGUnKVxufVxuXG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlS2V5KVxuXG5leHBvcnQgaW50ZXJmYWNlIEFydGljbGUge1xuICBpZD86IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGNvbnRlbnQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgYWlfc3VtbWFyeT86IHN0cmluZ1xuICB1cmw6IHN0cmluZ1xuICBzb3VyY2U6IHN0cmluZ1xuICBhdXRob3I/OiBzdHJpbmdcbiAgcHVibGlzaGVkX2F0Pzogc3RyaW5nXG4gIGltYWdlX3VybD86IHN0cmluZ1xuICBpbWFnZV9tZXRhZGF0YT86IHtcbiAgICBvcmlnaW5hbD86IHN0cmluZ1xuICAgIG9wdGltaXplZD86IHN0cmluZ1xuICAgIHdoYXRzYXBwPzogc3RyaW5nXG4gIH1cbiAgY2F0ZWdvcnk/OiBzdHJpbmdcbiAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICB1cGRhdGVkX2F0Pzogc3RyaW5nXG4gIGlzX2FpX2VuaGFuY2VkPzogYm9vbGVhblxuICBvcmlnaW5hbF9hcnRpY2xlX2lkPzogc3RyaW5nXG4gIGVuaGFuY2VtZW50X21ldGFkYXRhPzoge1xuICAgIHNlYXJjaFF1ZXJpZXM6IHN0cmluZ1tdXG4gICAgc291cmNlczogc3RyaW5nW11cbiAgICByZWxhdGVkVG9waWNzOiBzdHJpbmdbXVxuICAgIGVuaGFuY2VkQXQ6IHN0cmluZ1xuICAgIGVuaGFuY2VtZW50Q29zdD86IHN0cmluZ1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlQXJ0aWNsZShhcnRpY2xlOiBBcnRpY2xlKSB7XG4gIHRyeSB7XG4gICAgLy8gQ2hlY2sgaWYgYXJ0aWNsZSBhbHJlYWR5IGV4aXN0cyBieSBVUkxcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oXCJhcnRpY2xlc1wiKVxuICAgICAgLnNlbGVjdChcImlkLCB0aXRsZSwgY3JlYXRlZF9hdFwiKVxuICAgICAgLmVxKFwidXJsXCIsIGFydGljbGUudXJsKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgIGNvbnNvbGUubG9nKGDij63vuI8gIEFydGljbGUgYWxyZWFkeSBleGlzdHMgKHNraXBwaW5nKTogJHthcnRpY2xlLnRpdGxlfWApXG4gICAgICBjb25zb2xlLmxvZyhgICAg8J+ThSBPcmlnaW5hbGx5IHNhdmVkOiAke25ldyBEYXRlKGV4aXN0aW5nLmNyZWF0ZWRfYXQpLnRvTG9jYWxlU3RyaW5nKCl9YClcbiAgICAgIHJldHVybiB7IC4uLmV4aXN0aW5nLCBza2lwcGVkOiB0cnVlIH1cbiAgICB9XG5cbiAgICAvLyBJbnNlcnQgbmV3IGFydGljbGVcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oXCJhcnRpY2xlc1wiKVxuICAgICAgLmluc2VydChbXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogYXJ0aWNsZS50aXRsZSxcbiAgICAgICAgICBjb250ZW50OiBhcnRpY2xlLmNvbnRlbnQsXG4gICAgICAgICAgc3VtbWFyeTogYXJ0aWNsZS5zdW1tYXJ5LFxuICAgICAgICAgIGFpX3N1bW1hcnk6IGFydGljbGUuYWlfc3VtbWFyeSxcbiAgICAgICAgICB1cmw6IGFydGljbGUudXJsLFxuICAgICAgICAgIHNvdXJjZTogYXJ0aWNsZS5zb3VyY2UsXG4gICAgICAgICAgYXV0aG9yOiBhcnRpY2xlLmF1dGhvcixcbiAgICAgICAgICBpbWFnZV91cmw6IChhcnRpY2xlIGFzIGFueSkuaW1hZ2VVcmwgfHwgYXJ0aWNsZS5pbWFnZV91cmwsXG4gICAgICAgICAgY2F0ZWdvcnk6IGFydGljbGUuY2F0ZWdvcnkgfHwgXCJHZW5lcmFsXCIsXG4gICAgICAgICAgaXNfYWlfZW5oYW5jZWQ6IGFydGljbGUuaXNfYWlfZW5oYW5jZWQgfHwgZmFsc2UsXG4gICAgICAgICAgb3JpZ2luYWxfYXJ0aWNsZV9pZDogYXJ0aWNsZS5vcmlnaW5hbF9hcnRpY2xlX2lkLFxuICAgICAgICAgIGVuaGFuY2VtZW50X21ldGFkYXRhOiBhcnRpY2xlLmVuaGFuY2VtZW50X21ldGFkYXRhLFxuICAgICAgICB9LFxuICAgICAgXSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzYXZpbmcgYXJ0aWNsZTpcIiwgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGDinIUgU2F2ZWQgbmV3IGFydGljbGU6ICR7YXJ0aWNsZS50aXRsZX1gKVxuICAgIHJldHVybiB7IC4uLmRhdGEsIHNraXBwZWQ6IGZhbHNlIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW4gc2F2ZUFydGljbGU6XCIsIGVycm9yKVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFydGljbGVTdGF0cygpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oXCJhcnRpY2xlc1wiKVxuICAgICAgLnNlbGVjdChcInNvdXJjZSwgY3JlYXRlZF9hdFwiKVxuICAgICAgLm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFydGljbGUgc3RhdHM6XCIsIGVycm9yKVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0cyA9IHtcbiAgICAgIHRvdGFsOiBkYXRhLmxlbmd0aCxcbiAgICAgIGJ5U291cmNlOiB7fSxcbiAgICAgIGxhdGVzdDogZGF0YVswXT8uY3JlYXRlZF9hdCxcbiAgICAgIG9sZGVzdDogZGF0YVtkYXRhLmxlbmd0aCAtIDFdPy5jcmVhdGVkX2F0LFxuICAgIH1cblxuICAgIC8vIENvdW50IGJ5IHNvdXJjZVxuICAgIGRhdGEuZm9yRWFjaCgoYXJ0aWNsZSkgPT4ge1xuICAgICAgc3RhdHMuYnlTb3VyY2VbYXJ0aWNsZS5zb3VyY2VdID0gKHN0YXRzLmJ5U291cmNlW2FydGljbGUuc291cmNlXSB8fCAwKSArIDFcbiAgICB9KVxuXG4gICAgcmV0dXJuIHN0YXRzXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdldHRpbmcgYXJ0aWNsZSBzdGF0czpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIG51bGxcbiAgfVxufVxuXG4vLyBCYWxhbmNlZCBxdWVyeSBmdW5jdGlvbiB0byBlbnN1cmUgcHJvcG9ydGlvbmFsIHJlcHJlc2VudGF0aW9uIGZyb20gYWxsIHNvdXJjZXNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRCYWxhbmNlZEFydGljbGVzKHBhZ2UgPSAwLCBsaW1pdCA9IDEwLCBmaWx0ZXJzPzogeyBzb3VyY2U/OiBzdHJpbmcsIGlzQWlFbmhhbmNlZD86IGJvb2xlYW4sIGxhbmd1YWdlPzogc3RyaW5nLCBjYXRlZ29yeT86IHN0cmluZywgaGFzRW5yaWNobWVudD86IGJvb2xlYW4gfSkge1xuICB0cnkge1xuICAgIC8vIElmIHNwZWNpZmljIHNvdXJjZSBvciBjYXRlZ29yeSBmaWx0ZXIgaXMgYXBwbGllZCwgdXNlIHJlZ3VsYXIgcXVlcnlcbiAgICBpZiAoZmlsdGVycz8uc291cmNlIHx8IGZpbHRlcnM/LmNhdGVnb3J5KSB7XG4gICAgICByZXR1cm4gZ2V0QXJ0aWNsZXNSZWd1bGFyKHBhZ2UsIGxpbWl0LCBmaWx0ZXJzKVxuICAgIH1cblxuICAgIC8vIERlZmluZSBrbm93biBzb3VyY2VzIGFuZCB0aGVpciBkZXNpcmVkIHByb3BvcnRpb25zXG4gICAgY29uc3Qgc291cmNlcyA9IFsnSEswMScsICdvbi5jYycsICdTaW5nVGFvJywgJ1JUSEsnLCAnSEtGUCcsICdPTkNDJywgJ2FtNzMwJywgJ3NjbXAnLCAnYmxvb21iZXJnJ11cbiAgICBjb25zdCBhcnRpY2xlc1BlclNvdXJjZSA9IE1hdGgubWF4KDEsIE1hdGguZmxvb3IobGltaXQgLyBzb3VyY2VzLmxlbmd0aCkpXG4gICAgY29uc3QgZXh0cmFBcnRpY2xlcyA9IGxpbWl0ICUgc291cmNlcy5sZW5ndGhcbiAgICBcbiAgICBjb25zdCBhbGxBcnRpY2xlcyA9IFtdXG4gICAgXG4gICAgLy8gR2V0IGFydGljbGVzIGZyb20gZWFjaCBzb3VyY2UgcHJvcG9ydGlvbmFsbHkgd2l0aCBwcm9wZXIgcGFnaW5hdGlvblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgc291cmNlID0gc291cmNlc1tpXVxuICAgICAgY29uc3Qgc291cmNlTGltaXQgPSBhcnRpY2xlc1BlclNvdXJjZSArIChpIDwgZXh0cmFBcnRpY2xlcyA/IDEgOiAwKVxuICAgICAgXG4gICAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxuICAgICAgICAuZnJvbShcImFydGljbGVzXCIpXG4gICAgICAgIC5zZWxlY3QoXCIqXCIpXG4gICAgICAgIC5pbignc291cmNlJywgW3NvdXJjZSwgYCR7c291cmNlfSAoQUkgRW5oYW5jZWQpYF0pXG4gICAgICAgIC5vcmRlcihcImNyZWF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG4gICAgICBcbiAgICAgIC8vIEFwcGx5IEFJIGVuaGFuY2VkIGZpbHRlciBpZiBzcGVjaWZpZWRcbiAgICAgIGlmIChmaWx0ZXJzPy5pc0FpRW5oYW5jZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdpc19haV9lbmhhbmNlZCcsIGZpbHRlcnMuaXNBaUVuaGFuY2VkKVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBcHBseSBsYW5ndWFnZSBmaWx0ZXIgaWYgc3BlY2lmaWVkIC0gdXNlIG9ubHkgbWV0YWRhdGEgKGxhbmd1YWdlIGNvbHVtbiBkb2Vzbid0IGV4aXN0KVxuICAgICAgaWYgKGZpbHRlcnM/Lmxhbmd1YWdlKSB7XG4gICAgICAgIGlmIChmaWx0ZXJzLmxhbmd1YWdlICE9PSBcImVuXCIpIHtcbiAgICAgICAgICAvLyBGb3Igbm9uLUVuZ2xpc2ggbGFuZ3VhZ2VzLCBjaGVjayBtZXRhZGF0YSBsYW5ndWFnZVxuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2VuaGFuY2VtZW50X21ldGFkYXRhLT4+bGFuZ3VhZ2UnLCBmaWx0ZXJzLmxhbmd1YWdlKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZvciBFbmdsaXNoLCBpbmNsdWRlIGFydGljbGVzIHdoZXJlIG1ldGFkYXRhIHNob3dzICdlbicgT1IgbWV0YWRhdGEgbGFuZ3VhZ2UgaXMgbnVsbC9taXNzaW5nXG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS5vcihgZW5oYW5jZW1lbnRfbWV0YWRhdGEtPj5sYW5ndWFnZS5lcS5lbixlbmhhbmNlbWVudF9tZXRhZGF0YS0+Pmxhbmd1YWdlLmlzLm51bGxgKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVzZSBwcm9wZXIgcGFnaW5hdGlvbiB3aXRoIHJhbmdlIGluc3RlYWQgb2YgbGltaXQgKyBzbGljZVxuICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IHNvdXJjZUxpbWl0ICogcGFnZVxuICAgICAgY29uc3QgZW5kSW5kZXggPSBzdGFydEluZGV4ICsgc291cmNlTGltaXQgLSAxXG4gICAgICBcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5LnJhbmdlKHN0YXJ0SW5kZXgsIGVuZEluZGV4KVxuICAgICAgXG4gICAgICBpZiAoIWVycm9yICYmIGRhdGEpIHtcbiAgICAgICAgYWxsQXJ0aWNsZXMucHVzaCguLi5kYXRhKVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBTb3J0IHRoZSBtaXhlZCBhcnRpY2xlcyBieSBjcmVhdGlvbiBkYXRlIChuZXdlc3QgZmlyc3QpXG4gICAgYWxsQXJ0aWNsZXMuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi5jcmVhdGVkX2F0KS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShhLmNyZWF0ZWRfYXQpLmdldFRpbWUoKSlcbiAgICBcbiAgICByZXR1cm4gYWxsQXJ0aWNsZXMuc2xpY2UoMCwgbGltaXQpXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGJhbGFuY2VkIGFydGljbGVzOlwiLCBlcnJvcilcbiAgICAvLyBGYWxsYmFjayB0byByZWd1bGFyIHF1ZXJ5XG4gICAgcmV0dXJuIGdldEFydGljbGVzUmVndWxhcihwYWdlLCBsaW1pdCwgZmlsdGVycylcbiAgfVxufVxuXG4vLyBPcmlnaW5hbCBxdWVyeSBmdW5jdGlvbiAocmVuYW1lZCBmb3IgY2xhcml0eSlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBcnRpY2xlc1JlZ3VsYXIocGFnZSA9IDAsIGxpbWl0ID0gMTAsIGZpbHRlcnM/OiB7IHNvdXJjZT86IHN0cmluZywgaXNBaUVuaGFuY2VkPzogYm9vbGVhbiwgbGFuZ3VhZ2U/OiBzdHJpbmcsIGNhdGVnb3J5Pzogc3RyaW5nLCBoYXNFbnJpY2htZW50PzogYm9vbGVhbiB9KSB7XG4gIHRyeSB7XG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwiYXJ0aWNsZXNcIilcbiAgICAgIC5zZWxlY3QoXCIqXCIpXG4gICAgICAub3JkZXIoXCJjcmVhdGVkX2F0XCIsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgIFxuICAgIC8vIEFwcGx5IGZpbHRlcnMgaWYgcHJvdmlkZWRcbiAgICBpZiAoZmlsdGVycz8uc291cmNlKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdzb3VyY2UnLCBmaWx0ZXJzLnNvdXJjZSlcbiAgICB9XG4gICAgXG4gICAgaWYgKGZpbHRlcnM/LmNhdGVnb3J5KSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjYXRlZ29yeScsIGZpbHRlcnMuY2F0ZWdvcnkpXG4gICAgfVxuICAgIFxuICAgIGlmIChmaWx0ZXJzPy5pc0FpRW5oYW5jZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnaXNfYWlfZW5oYW5jZWQnLCBmaWx0ZXJzLmlzQWlFbmhhbmNlZClcbiAgICB9XG4gICAgXG4gICAgLy8gQXBwbHkgbGFuZ3VhZ2UgZmlsdGVyIGlmIHNwZWNpZmllZCAtIHVzZSBvbmx5IG1ldGFkYXRhIChsYW5ndWFnZSBjb2x1bW4gZG9lc24ndCBleGlzdClcbiAgICBpZiAoZmlsdGVycz8ubGFuZ3VhZ2UpIHtcbiAgICAgIGlmIChmaWx0ZXJzLmxhbmd1YWdlICE9PSBcImVuXCIpIHtcbiAgICAgICAgLy8gRm9yIG5vbi1FbmdsaXNoIGxhbmd1YWdlcywgY2hlY2sgbWV0YWRhdGEgbGFuZ3VhZ2VcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnZW5oYW5jZW1lbnRfbWV0YWRhdGEtPj5sYW5ndWFnZScsIGZpbHRlcnMubGFuZ3VhZ2UpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGb3IgRW5nbGlzaCwgaW5jbHVkZSBhcnRpY2xlcyB3aGVyZSBtZXRhZGF0YSBzaG93cyAnZW4nIE9SIG1ldGFkYXRhIGxhbmd1YWdlIGlzIG51bGwvbWlzc2luZ1xuICAgICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBlbmhhbmNlbWVudF9tZXRhZGF0YS0+Pmxhbmd1YWdlLmVxLmVuLGVuaGFuY2VtZW50X21ldGFkYXRhLT4+bGFuZ3VhZ2UuaXMubnVsbGApXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGlmIChmaWx0ZXJzPy5oYXNFbnJpY2htZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChmaWx0ZXJzLmhhc0VucmljaG1lbnQpIHtcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5ub3QoJ2FpX3N1bW1hcnknLCAnaXMnLCBudWxsKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5pcygnYWlfc3VtbWFyeScsIG51bGwpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5LnJhbmdlKHBhZ2UgKiBsaW1pdCwgKHBhZ2UgKyAxKSAqIGxpbWl0IC0gMSlcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gSWYgdGFibGUgZG9lc24ndCBleGlzdCwgcmV0dXJuIGVtcHR5IGFycmF5IGluc3RlYWQgb2YgdGhyb3dpbmdcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSBcIjQyUDAxXCIgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImRvZXMgbm90IGV4aXN0XCIpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkFydGljbGVzIHRhYmxlIGRvZXMgbm90IGV4aXN0LiBQbGVhc2UgcnVuIHRoZSBkYXRhYmFzZSBzZXR1cC5cIilcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgICByZXR1cm4gZGF0YSB8fCBbXVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBhcnRpY2xlczpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIFtdXG4gIH1cbn1cblxuLy8gTWFpbiBleHBvcnQgLSB1c2UgcmVndWxhciBxdWVyeSBmb3IgYmV0dGVyIHBhZ2luYXRpb24gcmVsaWFiaWxpdHlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBcnRpY2xlcyhwYWdlID0gMCwgbGltaXQgPSAxMCwgZmlsdGVycz86IHsgc291cmNlPzogc3RyaW5nLCBpc0FpRW5oYW5jZWQ/OiBib29sZWFuLCBsYW5ndWFnZT86IHN0cmluZywgY2F0ZWdvcnk/OiBzdHJpbmcsIGhhc0VucmljaG1lbnQ/OiBib29sZWFuIH0pIHtcbiAgcmV0dXJuIGdldEFydGljbGVzUmVndWxhcihwYWdlLCBsaW1pdCwgZmlsdGVycylcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlYXJjaEFydGljbGVzKHF1ZXJ5OiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oXCJhcnRpY2xlc1wiKVxuICAgICAgLnNlbGVjdChcIipcIilcbiAgICAgIC5vcihgdGl0bGUuaWxpa2UuJSR7cXVlcnl9JSxzdW1tYXJ5LmlsaWtlLiUke3F1ZXJ5fSUsYWlfc3VtbWFyeS5pbGlrZS4lJHtxdWVyeX0lYClcbiAgICAgIC5vcmRlcihcImNyZWF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG4gICAgICAubGltaXQoMjApXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIElmIHRhYmxlIGRvZXNuJ3QgZXhpc3QsIHJldHVybiBlbXB0eSBhcnJheSBpbnN0ZWFkIG9mIHRocm93aW5nXG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gXCI0MlAwMVwiIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJkb2VzIG5vdCBleGlzdFwiKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJBcnRpY2xlcyB0YWJsZSBkb2VzIG5vdCBleGlzdC4gUGxlYXNlIHJ1biB0aGUgZGF0YWJhc2Ugc2V0dXAuXCIpXG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gICAgcmV0dXJuIGRhdGEgfHwgW11cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2VhcmNoaW5nIGFydGljbGVzOlwiLCBlcnJvcilcbiAgICByZXR1cm4gW11cbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXJ0aWNsZUJ5SWQoaWQ6IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGDwn5ONIGdldEFydGljbGVCeUlkIGNhbGxlZCB3aXRoIElEOiAke2lkfWApXG4gICAgXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbShcImFydGljbGVzXCIpLnNlbGVjdChcIipcIikuZXEoXCJpZFwiLCBpZCkuc2luZ2xlKClcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIGZldGNoaW5nIGFydGljbGUgJHtpZH06YCwgZXJyb3IpXG4gICAgICBcbiAgICAgIC8vIElmIG5vdCBmb3VuZCwgbG9nIHNhbXBsZSBJRHMgZm9yIGRlYnVnZ2luZ1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhOiBzYW1wbGVBcnRpY2xlcyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAuZnJvbShcImFydGljbGVzXCIpXG4gICAgICAgICAgLnNlbGVjdChcImlkXCIpXG4gICAgICAgICAgLmxpbWl0KDUpXG4gICAgICAgIGNvbnNvbGUubG9nKFwi8J+TiyBTYW1wbGUgYXJ0aWNsZSBJRHMgaW4gZGF0YWJhc2U6XCIsIHNhbXBsZUFydGljbGVzPy5tYXAoYSA9PiBhLmlkKSlcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSWYgdGFibGUgZG9lc24ndCBleGlzdCwgcmV0dXJuIG51bGwgaW5zdGVhZCBvZiB0aHJvd2luZ1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFwiNDJQMDFcIiB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiQXJ0aWNsZXMgdGFibGUgZG9lcyBub3QgZXhpc3QuIFBsZWFzZSBydW4gdGhlIGRhdGFiYXNlIHNldHVwLlwiKVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYOKchSBGb3VuZCBhcnRpY2xlOiAke2RhdGEudGl0bGV9YClcbiAgICByZXR1cm4gZGF0YVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBhcnRpY2xlIGJ5IElEOlwiLCBlcnJvcilcbiAgICByZXR1cm4gbnVsbFxuICB9XG59XG5cbi8vIEZ1bmN0aW9uIHRvIGdldCBlbmhhbmNlbWVudCBzdGF0aXN0aWNzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RW5oYW5jZW1lbnRTdGF0cygpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ2dldF9lbmhhbmNlbWVudF9zdGF0cycpXG4gICAgXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBlbmhhbmNlbWVudCBzdGF0czonLCBlcnJvcilcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBkYXRhPy5bMF0gfHwgbnVsbFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgZW5oYW5jZW1lbnQgc3RhdHM6JywgZXJyb3IpXG4gICAgcmV0dXJuIG51bGxcbiAgfVxufVxuXG4vLyBGdW5jdGlvbiB0byBjaGVjayBpZiBkYXRhYmFzZSBpcyBzZXQgdXBcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0RhdGFiYXNlU2V0dXAoKSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coXCJDaGVja2luZyBkYXRhYmFzZSBzZXR1cC4uLlwiKVxuXG4gICAgLy8gQWRkIHRpbWVvdXQgdG8gcHJldmVudCBoYW5naW5nIHJlcXVlc3RzXG4gICAgY29uc3QgdGltZW91dFByb21pc2UgPSBuZXcgUHJvbWlzZTxuZXZlcj4oKF8sIHJlamVjdCkgPT4gXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoJ0RhdGFiYXNlIGNoZWNrIHRpbWVvdXQnKSksIDMwMDApXG4gICAgKVxuXG4gICAgLy8gVHJ5IHRvIHNlbGVjdCBmcm9tIGFydGljbGVzIHRhYmxlIHdpdGggdGltZW91dFxuICAgIGNvbnN0IGRiUHJvbWlzZSA9IHN1cGFiYXNlLmZyb20oXCJhcnRpY2xlc1wiKS5zZWxlY3QoXCJpZFwiKS5saW1pdCgxKVxuICAgIFxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IFByb21pc2UucmFjZShbZGJQcm9taXNlLCB0aW1lb3V0UHJvbWlzZV0pXG5cbiAgICBjb25zb2xlLmxvZyhcIkRhdGFiYXNlIGNoZWNrIHJlc3VsdDpcIiwgeyBkYXRhLCBlcnJvciB9KVxuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRGF0YWJhc2UgY2hlY2sgZXJyb3I6XCIsIGVycm9yKVxuICAgICAgLy8gQ2hlY2sgZm9yIHNwZWNpZmljIGVycm9yIGNvZGVzIHRoYXQgaW5kaWNhdGUgdGFibGUgZG9lc24ndCBleGlzdFxuICAgICAgaWYgKFxuICAgICAgICBlcnJvci5jb2RlID09PSBcIjQyUDAxXCIgfHxcbiAgICAgICAgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImRvZXMgbm90IGV4aXN0XCIpIHx8XG4gICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJyZWxhdGlvblwiKSB8fFxuICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwidGFibGVcIilcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGZvciBSTFMvcGVybWlzc2lvbiBlcnJvcnMgKGNvbW1vbiBhZnRlciBlbmFibGluZyBSZWFsdGltZSlcbiAgICAgIGlmIChcbiAgICAgICAgZXJyb3IuY29kZSA9PT0gXCI0MjUwMVwiIHx8XG4gICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJwZXJtaXNzaW9uIGRlbmllZFwiKSB8fFxuICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiUkxTXCIpIHx8XG4gICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJwb2xpY3lcIilcbiAgICAgICkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJEYXRhYmFzZSBleGlzdHMgYnV0IFJMUyBwb2xpY2llcyBtYXkgYmUgYmxvY2tpbmcgYWNjZXNzXCIpXG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuICAgICAgLy8gRm9yIG90aGVyIGVycm9ycywgYXNzdW1lIHRhYmxlIGV4aXN0cyBidXQgdGhlcmUgbWlnaHQgYmUgcGVybWlzc2lvbiBpc3N1ZXNcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCJEYXRhYmFzZSBzZXR1cCBjaGVjayBwYXNzZWRcIilcbiAgICByZXR1cm4gdHJ1ZVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJEYXRhYmFzZSBzZXR1cCBjaGVjayBmYWlsZWQ6XCIsIGVycm9yKVxuICAgIC8vIEhhbmRsZSB0aW1lb3V0IGFuZCBvdGhlciBlcnJvcnNcbiAgICBpZiAoZXJyb3IubWVzc2FnZSA9PT0gJ0RhdGFiYXNlIGNoZWNrIHRpbWVvdXQnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJEYXRhYmFzZSBjaGVjayB0aW1lZCBvdXQgLSBsaWtlbHkgUkxTIHBvbGljeSBpc3N1ZVwiKVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEhlYWRsaW5lIHtcbiAgaWQ/OiBzdHJpbmdcbiAgY2F0ZWdvcnk6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIHVybDogc3RyaW5nXG4gIHNvdXJjZTogc3RyaW5nXG4gIHB1Ymxpc2hlZF9hdDogc3RyaW5nXG4gIGNyZWF0ZWRfYXQ/OiBzdHJpbmdcbiAgaW1hZ2VfdXJsPzogc3RyaW5nXG4gIGF1dGhvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZUhlYWRsaW5lcyhoZWFkbGluZXM6IEhlYWRsaW5lW10pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oXCJoZWFkbGluZXNcIilcbiAgICAgIC5pbnNlcnQoaGVhZGxpbmVzKVxuICAgICAgLnNlbGVjdCgpXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzYXZpbmcgaGVhZGxpbmVzOlwiLCBlcnJvcilcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYOKchSBTYXZlZCAke2hlYWRsaW5lcy5sZW5ndGh9IGhlYWRsaW5lc2ApXG4gICAgcmV0dXJuIGRhdGFcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW4gc2F2ZUhlYWRsaW5lczpcIiwgZXJyb3IpXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SGVhZGxpbmVzKGNhdGVnb3J5Pzogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwiaGVhZGxpbmVzXCIpXG4gICAgICAuc2VsZWN0KFwiKlwiKVxuICAgICAgLm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblxuICAgIGlmIChjYXRlZ29yeSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcShcImNhdGVnb3J5XCIsIGNhdGVnb3J5KVxuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSBcIjQyUDAxXCIgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImRvZXMgbm90IGV4aXN0XCIpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkhlYWRsaW5lcyB0YWJsZSBkb2VzIG5vdCBleGlzdC4gUGxlYXNlIHJ1biB0aGUgZGF0YWJhc2Ugc2V0dXAuXCIpXG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YSB8fCBbXVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBoZWFkbGluZXM6XCIsIGVycm9yKVxuICAgIHJldHVybiBbXVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRIZWFkbGluZXNCeUNhdGVnb3J5KCkge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbShcImhlYWRsaW5lc1wiKVxuICAgICAgLnNlbGVjdChcIipcIilcbiAgICAgIC5vcmRlcihcImNyZWF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSBcIjQyUDAxXCIgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImRvZXMgbm90IGV4aXN0XCIpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkhlYWRsaW5lcyB0YWJsZSBkb2VzIG5vdCBleGlzdC4gUGxlYXNlIHJ1biB0aGUgZGF0YWJhc2Ugc2V0dXAuXCIpXG4gICAgICAgIHJldHVybiB7fVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG5cbiAgICAvLyBHcm91cCBoZWFkbGluZXMgYnkgY2F0ZWdvcnkgKG1heCAxMCBwZXIgY2F0ZWdvcnkpXG4gICAgY29uc3QgZ3JvdXBlZEhlYWRsaW5lcyA9IChkYXRhIHx8IFtdKS5yZWR1Y2UoKGFjYywgaGVhZGxpbmUpID0+IHtcbiAgICAgIGlmICghYWNjW2hlYWRsaW5lLmNhdGVnb3J5XSkge1xuICAgICAgICBhY2NbaGVhZGxpbmUuY2F0ZWdvcnldID0gW11cbiAgICAgIH1cbiAgICAgIGlmIChhY2NbaGVhZGxpbmUuY2F0ZWdvcnldLmxlbmd0aCA8IDEwKSB7XG4gICAgICAgIGFjY1toZWFkbGluZS5jYXRlZ29yeV0ucHVzaChoZWFkbGluZSlcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2NcbiAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBIZWFkbGluZVtdPilcblxuICAgIHJldHVybiBncm91cGVkSGVhZGxpbmVzXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGhlYWRsaW5lcyBieSBjYXRlZ29yeTpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIHt9XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBPbGRIZWFkbGluZXMoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwiaGVhZGxpbmVzXCIpXG4gICAgICAuZGVsZXRlKClcbiAgICAgIC5sdChcImNyZWF0ZWRfYXRcIiwgbmV3IERhdGUoRGF0ZS5ub3coKSAtIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpKVxuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2xlYW5pbmcgdXAgb2xkIGhlYWRsaW5lczpcIiwgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwi4pyFIENsZWFuZWQgdXAgb2xkIGhlYWRsaW5lc1wiKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBjbGVhbnVwT2xkSGVhZGxpbmVzOlwiLCBlcnJvcilcbiAgICB0aHJvdyBlcnJvclxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0hlYWRsaW5lc1RhYmxlU2V0dXAoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwiaGVhZGxpbmVzXCIpXG4gICAgICAuc2VsZWN0KFwiaWRcIilcbiAgICAgIC5saW1pdCgxKVxuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gXCI0MlAwMVwiIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJkb2VzIG5vdCBleGlzdFwiKSkge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWVcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiSGVhZGxpbmVzIHRhYmxlIHNldHVwIGNoZWNrIGZhaWxlZDpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJwbGV4aXR5TmV3cyB7XG4gIGlkPzogc3RyaW5nXG4gIGNhdGVnb3J5OiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICB0aXRsZV9lbj86IHN0cmluZ1xuICB1cmw6IHN0cmluZ1xuICBpbnNlcnRlZF9hdD86IHN0cmluZ1xuICB1cmxfaGFzaD86IHN0cmluZ1xuICBhcnRpY2xlX3N0YXR1czogJ3BlbmRpbmcnIHwgJ2VucmljaGVkJyB8ICdyZWFkeSdcbiAgYXJ0aWNsZV9odG1sPzogc3RyaW5nXG4gIGxlZGU/OiBzdHJpbmdcbiAgaW1hZ2VfcHJvbXB0Pzogc3RyaW5nXG4gIGltYWdlX3N0YXR1czogJ3BlbmRpbmcnIHwgJ3JlYWR5JyB8ICdmYWlsZWQnXG4gIGltYWdlX3VybD86IHN0cmluZ1xuICBpbWFnZV9saWNlbnNlPzogc3RyaW5nXG4gIFxuICAvLyBFbmhhbmNlZCBzdHJ1Y3R1cmVkIGNvbnRlbnQgZmllbGRzXG4gIGVuaGFuY2VkX3RpdGxlPzogc3RyaW5nXG4gIHN1bW1hcnk/OiBzdHJpbmdcbiAga2V5X3BvaW50cz86IHN0cmluZ1tdXG4gIHdoeV9pdF9tYXR0ZXJzPzogc3RyaW5nXG4gIHN0cnVjdHVyZWRfc291cmNlcz86IHtcbiAgICBjaXRhdGlvbnM6IHN0cmluZ1tdXG4gICAgc291cmNlczogQXJyYXk8e1xuICAgICAgdGl0bGU6IHN0cmluZ1xuICAgICAgdXJsOiBzdHJpbmdcbiAgICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gICAgICBkb21haW4/OiBzdHJpbmdcbiAgICB9PlxuICAgIGdlbmVyYXRlZF9hdDogc3RyaW5nXG4gIH1cbiAgXG4gIHNvdXJjZT86IHN0cmluZ1xuICBhdXRob3I/OiBzdHJpbmdcbiAgcGVycGxleGl0eV9tb2RlbD86IHN0cmluZ1xuICBnZW5lcmF0aW9uX2Nvc3Q/OiBudW1iZXJcbiAgc2VhcmNoX3F1ZXJpZXM/OiBzdHJpbmdbXVxuICBjaXRhdGlvbnM/OiBhbnlcbiAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICB1cGRhdGVkX2F0Pzogc3RyaW5nXG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBlcnBsZXhpdHlOZXdzKGNhdGVnb3J5Pzogc3RyaW5nLCBsaW1pdCA9IDIwKSB7XG4gIHRyeSB7XG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwicGVycGxleGl0eV9uZXdzXCIpXG4gICAgICAuc2VsZWN0KFwiKlwiKVxuICAgICAgLmVxKFwiYXJ0aWNsZV9zdGF0dXNcIiwgXCJyZWFkeVwiKVxuICAgICAgLm9yZGVyKFwidXBkYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblxuICAgIGlmIChjYXRlZ29yeSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcShcImNhdGVnb3J5XCIsIGNhdGVnb3J5KVxuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5LmxpbWl0KGxpbWl0KVxuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gXCI0MlAwMVwiIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJkb2VzIG5vdCBleGlzdFwiKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJQZXJwbGV4aXR5IG5ld3MgdGFibGUgZG9lcyBub3QgZXhpc3QuIFBsZWFzZSBydW4gdGhlIGRhdGFiYXNlIHNldHVwLlwiKVxuICAgICAgICByZXR1cm4gW11cbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGEgfHwgW11cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgUGVycGxleGl0eSBuZXdzOlwiLCBlcnJvcilcbiAgICByZXR1cm4gW11cbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UGVycGxleGl0eU5ld3NCeUNhdGVnb3J5KCkge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbShcInBlcnBsZXhpdHlfbmV3c1wiKVxuICAgICAgLnNlbGVjdChcIipcIilcbiAgICAgIC5lcShcImFydGljbGVfc3RhdHVzXCIsIFwicmVhZHlcIilcbiAgICAgIC5vcmRlcihcInVwZGF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSBcIjQyUDAxXCIgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImRvZXMgbm90IGV4aXN0XCIpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIlBlcnBsZXhpdHkgbmV3cyB0YWJsZSBkb2VzIG5vdCBleGlzdC4gUGxlYXNlIHJ1biB0aGUgZGF0YWJhc2Ugc2V0dXAuXCIpXG4gICAgICAgIHJldHVybiB7fVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG5cbiAgICAvLyBHcm91cCBieSBjYXRlZ29yeSAobWF4IDEwIHBlciBjYXRlZ29yeSlcbiAgICBjb25zdCBncm91cGVkTmV3cyA9IChkYXRhIHx8IFtdKS5yZWR1Y2UoKGFjYywgYXJ0aWNsZSkgPT4ge1xuICAgICAgaWYgKCFhY2NbYXJ0aWNsZS5jYXRlZ29yeV0pIHtcbiAgICAgICAgYWNjW2FydGljbGUuY2F0ZWdvcnldID0gW11cbiAgICAgIH1cbiAgICAgIGlmIChhY2NbYXJ0aWNsZS5jYXRlZ29yeV0ubGVuZ3RoIDwgMTApIHtcbiAgICAgICAgYWNjW2FydGljbGUuY2F0ZWdvcnldLnB1c2goYXJ0aWNsZSlcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2NcbiAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBQZXJwbGV4aXR5TmV3c1tdPilcblxuICAgIHJldHVybiBncm91cGVkTmV3c1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBQZXJwbGV4aXR5IG5ld3MgYnkgY2F0ZWdvcnk6XCIsIGVycm9yKVxuICAgIHJldHVybiB7fVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1BlcnBsZXhpdHlOZXdzVGFibGVTZXR1cCgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oXCJwZXJwbGV4aXR5X25ld3NcIilcbiAgICAgIC5zZWxlY3QoXCJpZFwiKVxuICAgICAgLmxpbWl0KDEpXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSBcIjQyUDAxXCIgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImRvZXMgbm90IGV4aXN0XCIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJQZXJwbGV4aXR5IG5ld3MgdGFibGUgc2V0dXAgY2hlY2sgZmFpbGVkOlwiLCBlcnJvcilcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiRXJyb3IiLCJzdXBhYmFzZSIsInNhdmVBcnRpY2xlIiwiYXJ0aWNsZSIsImRhdGEiLCJleGlzdGluZyIsImZyb20iLCJzZWxlY3QiLCJlcSIsInVybCIsInNpbmdsZSIsImNvbnNvbGUiLCJsb2ciLCJ0aXRsZSIsIkRhdGUiLCJjcmVhdGVkX2F0IiwidG9Mb2NhbGVTdHJpbmciLCJza2lwcGVkIiwiZXJyb3IiLCJpbnNlcnQiLCJjb250ZW50Iiwic3VtbWFyeSIsImFpX3N1bW1hcnkiLCJzb3VyY2UiLCJhdXRob3IiLCJpbWFnZV91cmwiLCJpbWFnZVVybCIsImNhdGVnb3J5IiwiaXNfYWlfZW5oYW5jZWQiLCJvcmlnaW5hbF9hcnRpY2xlX2lkIiwiZW5oYW5jZW1lbnRfbWV0YWRhdGEiLCJnZXRBcnRpY2xlU3RhdHMiLCJvcmRlciIsImFzY2VuZGluZyIsInN0YXRzIiwidG90YWwiLCJsZW5ndGgiLCJieVNvdXJjZSIsImxhdGVzdCIsIm9sZGVzdCIsImZvckVhY2giLCJnZXRCYWxhbmNlZEFydGljbGVzIiwicGFnZSIsImxpbWl0IiwiZmlsdGVycyIsImdldEFydGljbGVzUmVndWxhciIsInNvdXJjZXMiLCJhcnRpY2xlc1BlclNvdXJjZSIsIk1hdGgiLCJtYXgiLCJmbG9vciIsImV4dHJhQXJ0aWNsZXMiLCJhbGxBcnRpY2xlcyIsImkiLCJzb3VyY2VMaW1pdCIsInF1ZXJ5IiwiaW4iLCJpc0FpRW5oYW5jZWQiLCJ1bmRlZmluZWQiLCJsYW5ndWFnZSIsIm9yIiwic3RhcnRJbmRleCIsImVuZEluZGV4IiwicmFuZ2UiLCJwdXNoIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsInNsaWNlIiwiaGFzRW5yaWNobWVudCIsIm5vdCIsImlzIiwiY29kZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsIndhcm4iLCJnZXRBcnRpY2xlcyIsInNlYXJjaEFydGljbGVzIiwiZ2V0QXJ0aWNsZUJ5SWQiLCJpZCIsInNhbXBsZUFydGljbGVzIiwibWFwIiwiZ2V0RW5oYW5jZW1lbnRTdGF0cyIsInJwYyIsImNoZWNrRGF0YWJhc2VTZXR1cCIsInRpbWVvdXRQcm9taXNlIiwiUHJvbWlzZSIsIl8iLCJyZWplY3QiLCJzZXRUaW1lb3V0IiwiZGJQcm9taXNlIiwicmFjZSIsInNhdmVIZWFkbGluZXMiLCJoZWFkbGluZXMiLCJnZXRIZWFkbGluZXMiLCJnZXRIZWFkbGluZXNCeUNhdGVnb3J5IiwiZ3JvdXBlZEhlYWRsaW5lcyIsInJlZHVjZSIsImFjYyIsImhlYWRsaW5lIiwiY2xlYW51cE9sZEhlYWRsaW5lcyIsImRlbGV0ZSIsImx0Iiwibm93IiwidG9JU09TdHJpbmciLCJjaGVja0hlYWRsaW5lc1RhYmxlU2V0dXAiLCJnZXRQZXJwbGV4aXR5TmV3cyIsImdldFBlcnBsZXhpdHlOZXdzQnlDYXRlZ29yeSIsImdyb3VwZWROZXdzIiwiY2hlY2tQZXJwbGV4aXR5TmV3c1RhYmxlU2V0dXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/ws","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/isows"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Farticles%2Favailable-sources%2Froute&page=%2Fapi%2Farticles%2Favailable-sources%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Farticles%2Favailable-sources%2Froute.ts&appDir=%2FUsers%2Fmarkau%2Fpanora8A%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmarkau%2Fpanora8A&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();
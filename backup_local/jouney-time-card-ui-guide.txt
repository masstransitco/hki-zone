Here’s a step-by-step recipe to build the JourneyTimeCard as a self-contained React component, with minimal dependencies, maximal clarity, and all the micro-UX hooks we sketched out.

⸻

1. File Structure

src/
└── components/
    ├── JourneyTimeCard/
    │   ├── index.tsx
    │   ├── JourneyTimeCard.module.css
    │   └── icons/
    │       ├── StartFlag.svg
    │       └── EndFlag.svg


⸻

2. Dependencies
	•	React (hooks, memo)
	•	dayjs (for formatting capture timestamp)
	•	framer-motion (for the “flash” on refresh)
	•	typescript (for strict props typing)

Install:

npm install dayjs framer-motion


⸻

3. Define Props & Types (index.tsx)

interface JourneyTimeCardProps {
  from: string;             // e.g. "H1"
  to: string;               // e.g. "CH"
  timeMin: number;          // current journey minutes
  trendMin: number;         // delta vs. baseline
  colourId: 1|2|3;          // 1=green,2=amber,3=red
  capture: string;          // ISO timestamp
  locale?: 'en'|'zh';       // default "en"
  onRouteClick?: (from:string,to:string)=>void;
}

	•	Wrap the component in React.memo to avoid unnecessary re-renders.
	•	Use default props for locale and noop onRouteClick.

⸻

4. Write the CSS Module

JourneyTimeCard.module.css

.card {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  border-radius: 24px;
  background: #fff;
  position: relative;
  border: 4px solid transparent;
  cursor: pointer;
  user-select: none;
}
.card.green { border-color: #2ECC71; }
.card.amber { border-color: #F1C40F; }
.card.red   { border-color: #E74C3C; }

.label { font-family: Helvetica; font-size: 14px; color: #111; }
.time  { font-family: Helvetica; font-weight: bold; font-size: 18px; margin: 0 8px; }
.trend { font-family: Helvetica; font-size: 14px; color: #666; margin-left: 8px; }

.tooltip {
  position: absolute; bottom: 100%; left: 50%;
  transform: translateX(-50%);
  padding: 4px 8px;
  font-size: 12px; color: #000;
  background: rgba(255,255,255,0.9);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  border-radius: 4px;
  pointer-events: none;
  opacity: 0; transition: opacity 0.2s;
}
.card:hover .tooltip { opacity: 1; }


⸻

5. Implement the Component

import React, { useState, useEffect } from 'react';
import dayjs from 'dayjs';
import { motion, AnimatePresence } from 'framer-motion';
import styles from './JourneyTimeCard.module.css';
import StartFlag from './icons/StartFlag.svg';
import EndFlag   from './icons/EndFlag.svg';

const ringClasses = { 1: styles.green, 2: styles.amber, 3: styles.red };

export const JourneyTimeCard: React.FC<JourneyTimeCardProps> = React.memo(({
  from, to, timeMin, trendMin, colourId, capture, locale = 'en', onRouteClick
}) => {
  const [flash, setFlash] = useState(false);
  useEffect(() => {
    setFlash(true);
    const t = setTimeout(() => setFlash(false), 400);
    return () => clearTimeout(t);
  }, [timeMin, trendMin]);

  const displayTime = locale === 'en'
    ? `${timeMin} min`
    : `${timeMin} 分`;
  const displayTrend = trendMin === 0 ? '' : `${trendMin > 0 ? '▲' : '▼'}${Math.abs(trendMin)} min`;

  return (
    <motion.div
      className={`${styles.card} ${ringClasses[colourId]}`}
      onClick={() => onRouteClick?.(from, to)}
      animate={flash ? { scale: [1, 1.02, 1] } : {}}
      transition={{ duration: 0.4 }}
    >
      <img src={StartFlag} alt="" width={16} height={16}/>
      <span className={styles.label}>{from}</span>
      <span className={styles.time}>{displayTime}</span>
      {displayTrend && <span className={styles.trend}>{displayTrend}</span>}
      <img src={EndFlag} alt="" width={16} height={16}/>
      <span className={styles.label}>{to}</span>

      <div className={styles.tooltip}>
        As of {dayjs(capture).format('HH:mm')}
      </div>
    </motion.div>
  );
});


⸻

6. Data Hook & Refresh

Create a small hook to fetch and refresh:

function useJourneyData(routeId:string, intervalMs = 120000) {
  const [data, setData] = useState<JourneyTimeCardProps|null>(null);

  useEffect(() => {
    let cancelled = false;
    async function fetchOnce() {
      const res = await fetch(`/api/journey-time?route=${routeId}`);
      const json = await res.json();
      if (!cancelled) setData(json);
    }
    fetchOnce();
    const timer = setInterval(fetchOnce, intervalMs);
    return () => { cancelled = true; clearInterval(timer); };
  }, [routeId, intervalMs]);

  return data;
}


⸻

7. Integration Example

import React from 'react';
import { JourneyTimeCard } from './components/JourneyTimeCard';

export function Dashboard() {
  const routeData = useJourneyData('H1-CH');
  if (!routeData) return <div>Loading…</div>;

  return (
    <JourneyTimeCard
      {...routeData}
      onRouteClick={(f,t) => console.log('drill map:', f, t)}
    />
  );
}


⸻

8. Accessibility & Testing
	1.	ARIA: Add role="button" and aria-label={Route ${from} to ${to}: ${displayTime}} to the root div.
	2.	Unit tests (Jest+React Testing Library):
	•	Renders correct time/trend.
	•	Flashes when timeMin changes.
	•	Tooltip appears on hover.
	3.	Performance:
	•	Wrap with React.memo.
	•	CSS module ensures style isolation.

⸻

9. Localization
	•	Extract strings (“As of”, “min”) into a simple i18n map.
	•	Long-press handler: toggle locale in component state.

⸻

With these nine steps, you’ll have a production-ready, minimal-but-feature-rich JourneyTimeCard that slots seamlessly into HKI, gives drivers instant, actionable insights, and reinforces your brand’s clean, data-first ethos.